import{C as I,D as g,l as i,u as l,m as n,J as L,M as m,A as a,o as b,G as _,F as f,t as p,z as u,K as w,y as x,Q as B,P as j}from"./vendor-LkufkiF7.js";import{I as A}from"./LogoutButton-C42r2dkh.js";import{L as F}from"./Layout-B-7SKJ8y.js";import{T as D}from"./TextInput-BYPeFz6K.js";import{S as E}from"./SelectInput-BezpKrUW.js";import{S as M}from"./SelectInputFilter-CTeMp5E_.js";import{T}from"./TextareaInput-CS5Mn-lq.js";import{L as R}from"./LoadingButton-DNgtCulM.js";import{_ as q}from"./RichEditor-DpxhyXX8.js";import{a as v}from"./utils-Cv2kkzzw.js";import{_ as z}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./app-DgNNGg9T.js";import"./ui-DZ0wy3Ge.js";import"./Logo-CwTRbPbO.js";import"./FlashMessages-Bge5XBye.js";const N={components:{LoadingButton:R,SelectInput:E,SelectInputFilter:M,TextInput:D,TextareaInput:T,Link:I,Icon:A,RichEditor:q},layout:F,props:{customers:Array,usersExceptCustomers:Array,priorities:Array,statuses:Array,types:Array,departments:Array,all_categories:Array,auth:Object,hidden_fields:Object,custom_fields:Object},remember:!1,data(){var r,t;return{user_access:((t=(r=this.$page.props.auth)==null?void 0:r.user)==null?void 0:t.access)||{},categories:[],sub_categories:[],form:this.$inertia.form({user_id:null,priority_id:null,status_id:null,department_id:null,category_id:null,sub_category_id:null,assigned_to:null,type_id:null,subject:null,details:"",files:[],custom_field:{}}),localUsers:[...this.usersExceptCustomers],isLoading:!1}},watch:{"form.department_id":function(r){this.getCategories(r),this.getAssignees(r)}},created(){this.setDefaultValue(this.statuses,"status_id","Pending"),this.setDefaultValue(this.priorities,"priority_id","Generally")},methods:{getCategories(r){const t=r||this.form.department_id;this.categories=this.all_categories.filter(o=>o.department_id===t),this.form.category_id=null,this.$refs.category&&(this.$refs.category.selected=null)},getAssignees(r){const t=r||this.form.department_id;this.isLoading=!0,v.get(this.route("filter.users_except_customer",{department_id:t})).then(o=>{this.localUsers=o.data,this.isLoading=!1,this.form.assigned_to&&(this.localUsers.find(s=>s.id===this.form.assigned_to)||(this.form.assigned_to=null))}).catch(()=>{this.isLoading=!1})},getSubCategories(){this.sub_categories=this.all_categories.filter(r=>r.parent_id===this.form.category_id),this.form.sub_category_id=null,this.$refs.sub_category&&(this.$refs.sub_category.selected=null)},doFilter(r){v.get(this.route("filter.customers",{search:r.target.value})).then(t=>{this.customers.splice(0,this.customers.length,...t.data)})},doFilterUsersExceptCustomer(r){this.isLoading=!0,v.get(this.route("filter.users_except_customer",{search:r.target.value,department_id:this.form.department_id})).then(t=>{this.localUsers=t.data,this.isLoading=!1}).catch(()=>{this.isLoading=!1})},setDefaultValue(r,t,o){const y=r.find(s=>s.name.match(new RegExp(o+".*")));y&&(this.form[t]=y.id)},fileInputChange(r){let t=r.target.files;for(let o=0;o<t.length;o++)this.form.files.push(t[o])},fileRemove(r,t){this.form.files.splice(t,1)},getFileSize(r){const t=Math.floor(Math.log(r)/Math.log(1024));return(r/Math.pow(1024,t)).toFixed(2)*1+" "+["B","kB","MB","GB","TB"][t]},fileBrowse(){this.$refs.file.click()},store(){this.auth&&this.auth.user&&(this.form.user_id=this.auth.user.id),this.form.post(this.route("tickets.store"))}}},G={class:"bg-white rounded-md shadow overflow-hidden max-w-full"},O={class:"p-8 -mr-6 -mb-8 flex flex-wrap"},P=["value"],J=["value"],K={value:null},Q=["value"],H={value:null},W=["value"],X={value:null},Y=["value"],Z={class:"flex flex-col w-full"},$=["for"],ee={key:0,class:"pl-2 text-xs"},te=["onUpdate:modelValue","type","id","placeholder","required"],se=["id","onUpdate:modelValue","placeholder"],re={key:2,class:"mt-1 text-sm text-gray-500 dark:text-gray-300"},le={class:"pr-6 pb-8 w-full"},oe={key:0,class:"text-red-600 text-sm mt-1"},ie={class:"pr-6 pb-8 w-full lg:w-full flex-col"},ne={class:"flex-1 pr-1"},ue={class:"text-gray-500 text-xs"},ae=["onClick"],de={class:"px-8 py-4 bg-gray-50 border-t border-gray-100 flex justify-end items-center"};function me(r,t,o,y,s,d){const V=g("select-input-filter"),h=g("select-input"),C=g("text-input"),k=g("RichEditor"),U=g("icon"),S=g("loading-button");return l(),i("div",null,[n("div",G,[n("form",{onSubmit:t[12]||(t[12]=L((...e)=>d.store&&d.store(...e),["prevent"]))},[n("div",O,[s.user_access.ticket.update&&o.auth.user.role.slug!=="customer"?(l(),m(V,{key:0,placeholder:"Start typing",onInput:d.doFilter,items:o.customers,modelValue:s.form.user_id,"onUpdate:modelValue":t[0]||(t[0]=e=>s.form.user_id=e),error:s.form.errors.user_id,class:"pr-6 pb-8 w-full lg:w-1/3",label:r.$t("Customer")},null,8,["onInput","items","modelValue","error","label"])):a("",!0),s.user_access.ticket.update?(l(),m(h,{key:1,modelValue:s.form.priority_id,"onUpdate:modelValue":t[1]||(t[1]=e=>s.form.priority_id=e),error:s.form.errors.priority_id,class:"pr-6 pb-8 w-full lg:w-1/3",label:r.$t("Priority")},{default:_(()=>[t[13]||(t[13]=n("option",{value:null},null,-1)),(l(!0),i(f,null,p(o.priorities,e=>(l(),i("option",{key:e.id,value:e.id},u(e.name),9,P))),128))]),_:1},8,["modelValue","error","label"])):a("",!0),o.hidden_fields&&o.hidden_fields.includes("ticket_type")?a("",!0):(l(),m(h,{key:2,modelValue:s.form.type_id,"onUpdate:modelValue":t[2]||(t[2]=e=>s.form.type_id=e),error:s.form.errors.type_id,class:"pr-6 pb-8 w-full lg:w-1/3",label:r.$t("Type")},{default:_(()=>[t[14]||(t[14]=n("option",{value:null},null,-1)),(l(!0),i(f,null,p(o.types,e=>(l(),i("option",{key:e.id,value:e.id},u(e.name),9,J))),128))]),_:1},8,["modelValue","error","label"])),o.hidden_fields&&o.hidden_fields.includes("department")?a("",!0):(l(),m(h,{key:3,modelValue:s.form.department_id,"onUpdate:modelValue":t[3]||(t[3]=e=>s.form.department_id=e),error:s.form.errors.department_id,class:"pr-6 pb-5 md:col-span-6 lg:w-1/3",label:r.$t("Department")},{default:_(()=>[n("option",K,u(r.$t("Select a department")),1),(l(!0),i(f,null,p(o.departments,e=>(l(),i("option",{key:e.id,value:e.id},u(e.name),9,Q))),128))]),_:1},8,["modelValue","error","label"])),!(o.hidden_fields&&o.hidden_fields.includes("category"))&&s.form.department_id?(l(),m(h,{key:4,ref:"category",onChange:t[4]||(t[4]=e=>d.getSubCategories()),modelValue:s.form.category_id,"onUpdate:modelValue":t[5]||(t[5]=e=>s.form.category_id=e),error:s.form.errors.category_id,class:"pb-5 pr-6 md:col-span-6 lg:w-1/3",label:r.$t("Category")},{default:_(()=>[n("option",H,u(r.$t("Select a category")),1),(l(!0),i(f,null,p(s.categories,e=>(l(),i("option",{key:e.id,value:e.id},u(e.name),9,W))),128))]),_:1},8,["modelValue","error","label"])):a("",!0),s.form.category_id?(l(),m(h,{key:5,ref:"sub_category",modelValue:s.form.sub_category_id,"onUpdate:modelValue":t[6]||(t[6]=e=>s.form.sub_category_id=e),error:s.form.errors.sub_category_id,class:"pb-5 md:col-span-6 lg:w-1/3",label:r.$t("Sub Category")},{default:_(()=>[n("option",X,u(r.$t("Select a sub category")),1),(l(!0),i(f,null,p(s.sub_categories,e=>(l(),i("option",{key:e.id,value:e.id},u(e.name),9,Y))),128))]),_:1},8,["modelValue","error","label"])):a("",!0),o.auth.user.role.slug!=="customer"&&s.user_access.ticket.update&&!(o.hidden_fields&&o.hidden_fields.includes("assigned_to"))?(l(),m(V,{key:6,"is-loading":s.isLoading,placeholder:"Start typing",onInput:d.doFilterUsersExceptCustomer,items:s.localUsers,modelValue:s.form.assigned_to,"onUpdate:modelValue":t[7]||(t[7]=e=>s.form.assigned_to=e),error:s.form.errors.assigned_to,class:"pr-6 pb-8 w-full lg:w-1/3",label:r.$t("Assigned to")},null,8,["is-loading","onInput","items","modelValue","error","label"])):a("",!0),(l(!0),i(f,null,p(o.custom_fields,e=>(l(),i("div",{class:"pr-6 pb-8 w-full lg:w-1/3",key:e.id},[n("div",Z,[n("label",{for:["checkbox"].includes(e.type)?null:"ticket_field_"+e.id,class:"form-label"},[x(u(e.label)+" ",1),e.required?a("",!0):(l(),i("small",ee,"(optional)"))],8,$),["text","email","number"].includes(e.type)?w((l(),i("input",{key:0,"onUpdate:modelValue":c=>s.form.custom_field[e.name]=c,type:e.type,id:"ticket_field_"+e.id,placeholder:e.placeholder,required:e.required,class:"form-input"},null,8,te)),[[B,s.form.custom_field[e.name]]]):a("",!0),e.type==="textarea"?w((l(),i("textarea",{key:1,id:"ticket_field_"+e.id,rows:"2","onUpdate:modelValue":c=>s.form.custom_field[e.name]=c,class:"form-textarea",placeholder:e.placeholder},null,8,se)),[[j,s.form.custom_field[e.name]]]):a("",!0),e.hint?(l(),i("p",re,u(e.hint),1)):a("",!0)])]))),128)),b(C,{modelValue:s.form.subject,"onUpdate:modelValue":t[8]||(t[8]=e=>s.form.subject=e),error:s.form.errors.subject,class:"pr-6 pb-8 w-full lg:w-full",label:r.$t("Subject")},null,8,["modelValue","error","label"]),n("div",le,[t[15]||(t[15]=n("label",{class:"form-label"},"Request Details:",-1)),b(k,{modelValue:s.form.details,"onUpdate:modelValue":t[9]||(t[9]=e=>s.form.details=e),class:"mt-1"},null,8,["modelValue"]),s.form.errors.details?(l(),i("div",oe,u(s.form.errors.details),1)):a("",!0)]),n("input",{ref:"file",type:"file",accept:".xlsx,.xls,image/*,.doc, .docx,.ppt, .pptx,.txt,.pdf, .zip",class:"hidden",multiple:"multiple",onChange:t[10]||(t[10]=(...e)=>d.fileInputChange&&d.fileInputChange(...e))},null,544),n("div",ie,[n("button",{type:"button",class:"btn flex justify-center items-center",onClick:t[11]||(t[11]=(...e)=>d.fileBrowse&&d.fileBrowse(...e))},[b(U,{name:"file",class:"flex-shrink-0 h-8 fill-gray-400 pr-1"}),t[16]||(t[16]=x()),n("h4",null,u(r.$t("Attach files")),1)]),s.form.files.length?(l(!0),i(f,{key:0},p(s.form.files,(e,c)=>(l(),i("div",{class:"flex items-center justify-between pr-6 pt-8 w-full lg:w-1/2",key:c},[n("div",ne,[x(u(e.name)+" ",1),n("span",ue,"("+u(d.getFileSize(e.size))+")",1)]),n("button",{type:"button",class:"btn flex justify-center items-center",onClick:fe=>d.fileRemove(e,c)},u(r.$t("Remove")),9,ae)]))),128)):a("",!0)])]),n("div",de,[b(S,{loading:s.form.processing,class:"btn-indigo",type:"submit"},{default:_(()=>[x(u(r.$t("Create"))+" "+u(r.$t("Ticket")),1)]),_:1},8,["loading"])])],32)])])}const Ie=z(N,[["render",me]]);export{Ie as default};
