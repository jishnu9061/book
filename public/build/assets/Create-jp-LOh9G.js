import{C as B,D as g,l as i,u as s,m as u,J as I,M as m,A as a,o as h,G as _,F as f,t as p,z as n,K as V,y as b,Q as j,P as E}from"./vendor-2qHTh_Dj.js";import{I as F}from"./LogoutButton-COxmScRj.js";import{L as A}from"./Layout-ShnBwACy.js";import{T as D}from"./TextInput-DuHXvfi3.js";import{S as M}from"./SelectInput-pKSBvjbC.js";import{S as T}from"./SelectInputFilter-Doi_MMBD.js";import{T as R}from"./TextareaInput-DVRz7oKj.js";import{L}from"./LoadingButton-COF3xohK.js";import{_ as q}from"./RichEditor-BExqzm_8.js";import{a as w}from"./utils-11VKenW5.js";import{_ as z}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./app-BRoCd4Iw.js";import"./ui-ChkuEbnX.js";import"./Logo-Csl_cBJU.js";import"./FlashMessages-hgZ2_tor.js";const N={components:{LoadingButton:L,SelectInput:M,SelectInputFilter:T,TextInput:D,TextareaInput:R,Link:B,Icon:F,RichEditor:q},layout:A,props:{customers:Array,usersExceptCustomers:Array,priorities:Array,statuses:Array,types:Array,departments:Array,all_categories:Array,auth:Object,hidden_fields:Object,custom_fields:Object},remember:!1,data(){var l,t;return{user_access:((t=(l=this.$page.props.auth)==null?void 0:l.user)==null?void 0:t.access)||{},categories:[],sub_categories:[],form:this.$inertia.form({user_id:null,priority_id:null,status_id:null,department_id:null,category_id:null,sub_category_id:null,assigned_to:null,type_id:null,subject:null,details:"",files:[],custom_field:{}})}},created(){this.setDefaultValue(this.statuses,"status_id","Pending"),this.setDefaultValue(this.priorities,"priority_id","Generally")},methods:{getCategories(){this.categories=this.all_categories.filter(l=>l.department_id===this.form.department_id),this.form.category_id=null,this.$refs.category.selected=null},getSubCategories(){this.sub_categories=this.all_categories.filter(l=>l.parent_id===this.form.category_id),this.form.sub_category_id=null,this.$refs.sub_category.selected=null},doFilter(l){w.get(this.route("filter.customers",{search:l.target.value})).then(t=>{this.customers.splice(0,this.customers.length,...t.data)})},doFilterUsersExceptCustomer(l){w.get(this.route("filter.users_except_customer",{search:l.target.value})).then(t=>{this.usersExceptCustomers.splice(0,this.usersExceptCustomers.length,...t.data)})},setDefaultValue(l,t,o){const v=l.find(r=>r.name.match(new RegExp(o+".*")));v&&(this.form[t]=v.id)},fileInputChange(l){let t=l.target.files;for(let o=0;o<t.length;o++)this.form.files.push(t[o])},fileRemove(l,t){this.form.files.splice(t,1)},getFileSize(l){const t=Math.floor(Math.log(l)/Math.log(1024));return(l/Math.pow(1024,t)).toFixed(2)*1+" "+["B","kB","MB","GB","TB"][t]},fileBrowse(){this.$refs.file.click()},store(){this.auth&&this.auth.user&&(this.form.user_id=this.auth.user.id),this.form.post(this.route("tickets.store"))}}},G={class:"bg-white rounded-md shadow overflow-hidden max-w-full"},O={class:"p-8 -mr-6 -mb-8 flex flex-wrap"},P=["value"],J=["value"],K={value:null},Q=["value"],H={value:null},W=["value"],X={value:null},Y=["value"],Z={class:"flex flex-col w-full"},$=["for"],ee={key:0,class:"pl-2 text-xs"},te=["onUpdate:modelValue","type","id","placeholder","required"],re=["id","onUpdate:modelValue","placeholder"],le={key:2,class:"mt-1 text-sm text-gray-500 dark:text-gray-300"},se={class:"pr-6 pb-8 w-full"},oe={key:0,class:"text-red-600 text-sm mt-1"},ie={class:"pr-6 pb-8 w-full lg:w-full flex-col"},ue={class:"flex-1 pr-1"},ne={class:"text-gray-500 text-xs"},ae=["onClick"],de={class:"px-8 py-4 bg-gray-50 border-t border-gray-100 flex justify-end items-center"};function me(l,t,o,v,r,d){const x=g("select-input-filter"),y=g("select-input"),C=g("text-input"),k=g("RichEditor"),S=g("icon"),U=g("loading-button");return s(),i("div",null,[u("div",G,[u("form",{onSubmit:t[13]||(t[13]=I((...e)=>d.store&&d.store(...e),["prevent"]))},[u("div",O,[r.user_access.ticket.update&&o.auth.user.role.slug!=="customer"?(s(),m(x,{key:0,placeholder:"Start typing",onInput:d.doFilter,items:o.customers,modelValue:r.form.user_id,"onUpdate:modelValue":t[0]||(t[0]=e=>r.form.user_id=e),error:r.form.errors.user_id,class:"pr-6 pb-8 w-full lg:w-1/3",label:l.$t("Customer")},null,8,["onInput","items","modelValue","error","label"])):a("",!0),r.user_access.ticket.update?(s(),m(y,{key:1,modelValue:r.form.priority_id,"onUpdate:modelValue":t[1]||(t[1]=e=>r.form.priority_id=e),error:r.form.errors.priority_id,class:"pr-6 pb-8 w-full lg:w-1/3",label:l.$t("Priority")},{default:_(()=>[t[14]||(t[14]=u("option",{value:null},null,-1)),(s(!0),i(f,null,p(o.priorities,e=>(s(),i("option",{key:e.id,value:e.id},n(e.name),9,P))),128))]),_:1},8,["modelValue","error","label"])):a("",!0),o.hidden_fields&&o.hidden_fields.includes("ticket_type")?a("",!0):(s(),m(y,{key:2,modelValue:r.form.type_id,"onUpdate:modelValue":t[2]||(t[2]=e=>r.form.type_id=e),error:r.form.errors.type_id,class:"pr-6 pb-8 w-full lg:w-1/3",label:l.$t("Type")},{default:_(()=>[t[15]||(t[15]=u("option",{value:null},null,-1)),(s(!0),i(f,null,p(o.types,e=>(s(),i("option",{key:e.id,value:e.id},n(e.name),9,J))),128))]),_:1},8,["modelValue","error","label"])),o.hidden_fields&&o.hidden_fields.includes("department")?a("",!0):(s(),m(y,{key:3,onChange:t[3]||(t[3]=e=>d.getCategories()),modelValue:r.form.department_id,"onUpdate:modelValue":t[4]||(t[4]=e=>r.form.department_id=e),error:r.form.errors.department_id,class:"pr-6 pb-5 md:col-span-6 lg:w-1/3",label:l.$t("Department")},{default:_(()=>[u("option",K,n(l.$t("Select a department")),1),(s(!0),i(f,null,p(o.departments,e=>(s(),i("option",{key:e.id,value:e.id},n(e.name),9,Q))),128))]),_:1},8,["modelValue","error","label"])),!(o.hidden_fields&&o.hidden_fields.includes("category"))&&r.form.department_id?(s(),m(y,{key:4,ref:"category",onChange:t[5]||(t[5]=e=>d.getSubCategories()),modelValue:r.form.category_id,"onUpdate:modelValue":t[6]||(t[6]=e=>r.form.category_id=e),error:r.form.errors.category_id,class:"pb-5 pr-6 md:col-span-6 lg:w-1/3",label:l.$t("Category")},{default:_(()=>[u("option",H,n(l.$t("Select a category")),1),(s(!0),i(f,null,p(r.categories,e=>(s(),i("option",{key:e.id,value:e.id},n(e.name),9,W))),128))]),_:1},8,["modelValue","error","label"])):a("",!0),r.form.category_id?(s(),m(y,{key:5,ref:"sub_category",modelValue:r.form.sub_category_id,"onUpdate:modelValue":t[7]||(t[7]=e=>r.form.sub_category_id=e),error:r.form.errors.sub_category_id,class:"pb-5 md:col-span-6 lg:w-1/3",label:l.$t("Sub Category")},{default:_(()=>[u("option",X,n(l.$t("Select a sub category")),1),(s(!0),i(f,null,p(r.sub_categories,e=>(s(),i("option",{key:e.id,value:e.id},n(e.name),9,Y))),128))]),_:1},8,["modelValue","error","label"])):a("",!0),o.auth.user.role.slug!=="customer"&&r.user_access.ticket.update&&!(o.hidden_fields&&o.hidden_fields.includes("assigned_to"))?(s(),m(x,{key:6,placeholder:"Start typing",onInput:d.doFilterUsersExceptCustomer,items:o.usersExceptCustomers,modelValue:r.form.assigned_to,"onUpdate:modelValue":t[8]||(t[8]=e=>r.form.assigned_to=e),error:r.form.errors.assigned_to,class:"pr-6 pb-8 w-full lg:w-1/3",label:l.$t("Assigned to")},null,8,["onInput","items","modelValue","error","label"])):a("",!0),(s(!0),i(f,null,p(o.custom_fields,e=>(s(),i("div",{class:"pr-6 pb-8 w-full lg:w-1/3",key:e.id},[u("div",Z,[u("label",{for:["checkbox"].includes(e.type)?null:"ticket_field_"+e.id,class:"form-label"},[b(n(e.label)+" ",1),e.required?a("",!0):(s(),i("small",ee,"(optional)"))],8,$),["text","email","number"].includes(e.type)?V((s(),i("input",{key:0,"onUpdate:modelValue":c=>r.form.custom_field[e.name]=c,type:e.type,id:"ticket_field_"+e.id,placeholder:e.placeholder,required:e.required,class:"form-input"},null,8,te)),[[j,r.form.custom_field[e.name]]]):a("",!0),e.type==="textarea"?V((s(),i("textarea",{key:1,id:"ticket_field_"+e.id,rows:"2","onUpdate:modelValue":c=>r.form.custom_field[e.name]=c,class:"form-textarea",placeholder:e.placeholder},null,8,re)),[[E,r.form.custom_field[e.name]]]):a("",!0),e.hint?(s(),i("p",le,n(e.hint),1)):a("",!0)])]))),128)),h(C,{modelValue:r.form.subject,"onUpdate:modelValue":t[9]||(t[9]=e=>r.form.subject=e),error:r.form.errors.subject,class:"pr-6 pb-8 w-full lg:w-full",label:l.$t("Subject")},null,8,["modelValue","error","label"]),u("div",se,[t[16]||(t[16]=u("label",{class:"form-label"},"Request Details:",-1)),h(k,{modelValue:r.form.details,"onUpdate:modelValue":t[10]||(t[10]=e=>r.form.details=e),class:"mt-1"},null,8,["modelValue"]),r.form.errors.details?(s(),i("div",oe,n(r.form.errors.details),1)):a("",!0)]),u("input",{ref:"file",type:"file",accept:".xlsx,.xls,image/*,.doc, .docx,.ppt, .pptx,.txt,.pdf, .zip",class:"hidden",multiple:"multiple",onChange:t[11]||(t[11]=(...e)=>d.fileInputChange&&d.fileInputChange(...e))},null,544),u("div",ie,[u("button",{type:"button",class:"btn flex justify-center items-center",onClick:t[12]||(t[12]=(...e)=>d.fileBrowse&&d.fileBrowse(...e))},[h(S,{name:"file",class:"flex-shrink-0 h-8 fill-gray-400 pr-1"}),t[17]||(t[17]=b()),u("h4",null,n(l.$t("Attach files")),1)]),r.form.files.length?(s(!0),i(f,{key:0},p(r.form.files,(e,c)=>(s(),i("div",{class:"flex items-center justify-between pr-6 pt-8 w-full lg:w-1/2",key:c},[u("div",ue,[b(n(e.name)+" ",1),u("span",ne,"("+n(d.getFileSize(e.size))+")",1)]),u("button",{type:"button",class:"btn flex justify-center items-center",onClick:fe=>d.fileRemove(e,c)},n(l.$t("Remove")),9,ae)]))),128)):a("",!0)])]),u("div",de,[h(U,{loading:r.form.processing,class:"btn-indigo",type:"submit"},{default:_(()=>[b(n(l.$t("Create"))+" "+n(l.$t("Ticket")),1)]),_:1},8,["loading"])])],32)])])}const Be=z(N,[["render",me]]);export{Be as default};
