import{i as T,h as E}from"./InstallerApi-Dj1wJ3Su.js";import{_ as H}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{FileText as j,ArrowRight as B,ArrowLeft as U,CheckCircle as O,AlertTriangle as V,ChevronUp as X,LucideX as M,Check as q,Download as J}from"./ui-ChkuEbnX.js";import{D as u,l as i,u as o,m as t,o as x,A as b,z as m,p as Y,F as P,t as R,E as p,M as z,y as A,f as L,i as K,e as k,H as G}from"./vendor-2qHTh_Dj.js";import"./utils-11VKenW5.js";const Q={name:"InstallerProgress",components:{Download:J,Check:q,X:M,ChevronUp:X,AlertTriangle:V,CheckCircle:O,ArrowLeft:U,ArrowRight:B,FileText:j},props:{installData:{type:Object,required:!0}},emits:["complete","error"],setup(n,{emit:s}){const I=L(!1),r=L(!1),h=L([]),c=K([{id:"environment",title:"Setting up environment",description:"Configuring application environment variables",status:"pending",error:null},{id:"database",title:"Creating database tables",description:"Running database migrations",status:"pending",error:null},{id:"seed",title:"Seeding database",description:"Creating default data and admin account",status:"pending",error:null},{id:"permissions",title:"Setting up permissions",description:"Configuring file permissions and directories",status:"pending",error:null},{id:"cache",title:"Optimizing application",description:"Clearing cache and optimizing performance",status:"pending",error:null},{id:"finalize",title:"Finalizing installation",description:"Completing setup and marking as installed",status:"pending",error:null}]),f=k(()=>c.findIndex(e=>e.status==="running")),_=k(()=>{const e=c[f.value];return e?e.title:"Preparing installation..."}),w=k(()=>c.filter(g=>g.status==="completed").length/c.length*100),y=k(()=>c.some(e=>e.status==="error")),l=(e,g="info")=>{h.value.push({timestamp:new Date().toLocaleTimeString(),message:e,level:g})},D=e=>{switch(e){case"completed":return"Completed";case"running":return"Running";case"error":return"Failed";default:return"Pending"}},C=e=>{switch(e){case"error":return"text-red-400";case"warning":return"text-yellow-400";case"success":return"text-green-400";default:return"text-slate-300"}},d=(e,g,F=null)=>{const S=c.find(N=>N.id===e);S&&(S.status=g,S.error=F)},v=async()=>{try{l("Starting HelpDesk installation...","info"),d("environment","running"),l("Setting up environment variables...","info");try{const e=await T("/install/save-environment",{body:JSON.stringify({app_name:n.installData.environment.appName,app_url:n.installData.environment.appUrl,app_env:n.installData.environment.appEnv,app_debug:n.installData.environment.appDebug,database_connection:n.installData.database.connection,database_hostname:n.installData.database.host,database_port:n.installData.database.port,database_name:n.installData.database.name,database_username:n.installData.database.username,database_password:n.installData.database.password,mail_driver:n.installData.environment.mailDriver||"smtp",mail_host:n.installData.environment.mailHost||"",mail_port:n.installData.environment.mailPort||587,mail_username:n.installData.environment.mailUsername||"",mail_password:n.installData.environment.mailPassword||"",mail_encryption:n.installData.environment.mailEncryption||"tls",mail_from_address:n.installData.environment.mailFromAddress||"",pusher_app_id:n.installData.environment.pusherAppId||"",pusher_app_key:n.installData.environment.pusherAppKey||"",pusher_app_secret:n.installData.environment.pusherAppSecret||"",pusher_app_cluster:n.installData.environment.pusherAppCluster||"us2"})});await E(e),d("environment","completed"),l("Environment setup completed","success")}catch(e){throw d("environment","error",e.message),l(`Environment setup failed: ${e.message}`,"error"),e}d("database","running"),l("Running database migrations and installation...","info");try{const e=await T("/install/run-installation",{body:JSON.stringify({first_name:n.installData.admin.firstName,last_name:n.installData.admin.lastName,email:n.installData.admin.email,password:n.installData.admin.password})}),g=await E(e);d("database","completed"),l("Database migrations completed","success"),d("seed","completed"),l("Database seeding completed","success"),d("permissions","completed"),l("File permissions configured","success"),d("cache","completed"),l("Cache optimization completed","success"),d("finalize","completed"),l("Installation completed successfully!","success"),r.value=!0,l("HelpDesk is ready to use!","success"),l(`Admin user created: ${g.admin.email}`,"success")}catch(e){throw d("database","error",e.message),l(`Installation failed: ${e.message}`,"error"),e}}catch(e){l(`Installation failed: ${e.message}`,"error"),s("error",e)}},a=()=>{c.forEach(e=>{e.status="pending",e.error=null}),r.value=!1,h.value=[],v()};return G(()=>{setTimeout(()=>{v()},1e3)}),{showLog:I,installationComplete:r,installationLog:h,installationSteps:c,currentStepIndex:f,currentStepText:_,overallProgress:w,hasErrors:y,addLog:l,getStatusText:D,getLogColor:C,retryInstallation:a}}},W={class:"animate-fade-in-up"},Z={class:"text-center mb-8"},$={class:"w-20 h-20 bg-gradient-to-br from-green-500 to-teal-600 rounded-2xl flex items-center justify-center mx-auto mb-6"},ee={class:"max-w-3xl mx-auto"},te={class:"bg-slate-50 dark:bg-slate-700/50 rounded-xl p-6 mb-6"},ae={class:"flex items-center justify-between mb-4"},se={class:"text-sm font-medium text-slate-600 dark:text-slate-400"},ne={class:"w-full bg-slate-200 dark:bg-slate-600 rounded-full h-3 mb-4"},re={class:"text-center"},le={class:"text-sm text-slate-600 dark:text-slate-400"},oe={class:"space-y-4 mb-6"},ie={key:1,class:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"},de={key:3,class:"text-sm font-semibold text-slate-500 dark:text-slate-400"},me={class:"flex-1"},ce={key:0,class:"mt-2 text-sm text-red-600 dark:text-red-400"},ue={key:0,class:"bg-slate-900 dark:bg-slate-800 rounded-xl p-6 mb-6"},ge={class:"flex items-center justify-between mb-4"},xe={class:"text-xs text-slate-300 font-mono max-h-40 overflow-y-auto"},be={class:"text-slate-500"},pe={key:1,class:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-xl p-6 mb-6"},he={class:"flex items-start"},fe={key:2,class:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-xl p-6"},ve={class:"flex items-center"},ke={class:"flex justify-between items-center mt-8 pt-6 border-t border-slate-200 dark:border-slate-700"},_e={key:1,class:"flex space-x-3"};function we(n,s,I,r,h,c){const f=u("Download"),_=u("Check"),w=u("X"),y=u("ChevronUp"),l=u("AlertTriangle"),D=u("CheckCircle"),C=u("ArrowLeft"),d=u("FileText"),v=u("ArrowRight");return o(),i("div",W,[t("div",Z,[t("div",$,[x(f,{class:"w-10 h-10 text-white"})]),s[5]||(s[5]=t("h2",{class:"text-3xl font-bold text-slate-900 dark:text-white mb-4"}," Installing HelpDesk ",-1)),s[6]||(s[6]=t("p",{class:"text-lg text-slate-600 dark:text-slate-400 max-w-2xl mx-auto"}," Please wait while we set up your HelpDesk system. This may take a few minutes. ",-1))]),t("div",ee,[t("div",te,[t("div",ae,[s[7]||(s[7]=t("h3",{class:"text-lg font-semibold text-slate-900 dark:text-white"},"Installation Progress",-1)),t("span",se,m(Math.round(r.overallProgress))+"% ",1)]),t("div",ne,[t("div",{class:"bg-gradient-to-r from-blue-600 to-indigo-600 h-3 rounded-full transition-all duration-500 ease-out",style:Y({width:r.overallProgress+"%"})},null,4)]),t("div",re,[t("p",le,m(r.currentStepText),1)])]),t("div",oe,[(o(!0),i(P,null,R(r.installationSteps,(a,e)=>(o(),i("div",{key:a.id,class:"flex items-center p-4 bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700"},[t("div",{class:p(["w-10 h-10 rounded-full flex items-center justify-center mr-4 transition-all duration-300",a.status==="completed"?"bg-green-100 dark:bg-green-900/30":a.status==="running"?"bg-blue-100 dark:bg-blue-900/30":a.status==="error"?"bg-red-100 dark:bg-red-900/30":"bg-slate-100 dark:bg-slate-700"])},[a.status==="completed"?(o(),z(_,{key:0,class:"w-5 h-5 text-green-600 dark:text-green-400"})):a.status==="running"?(o(),i("div",ie)):a.status==="error"?(o(),z(w,{key:2,class:"w-5 h-5 text-red-600 dark:text-red-400"})):(o(),i("span",de,m(e+1),1))],2),t("div",me,[t("h4",{class:p(["font-medium transition-colors",a.status==="completed"?"text-green-800 dark:text-green-200":a.status==="running"?"text-blue-800 dark:text-blue-200":a.status==="error"?"text-red-800 dark:text-red-200":"text-slate-700 dark:text-slate-300"])},m(a.title),3),t("p",{class:p(["text-sm transition-colors",a.status==="completed"?"text-green-600 dark:text-green-400":a.status==="running"?"text-blue-600 dark:text-blue-400":a.status==="error"?"text-red-600 dark:text-red-400":"text-slate-500 dark:text-slate-400"])},m(a.description),3),a.status==="error"&&a.error?(o(),i("div",ce," Error: "+m(a.error),1)):b("",!0)]),t("div",{class:p(["px-3 py-1 rounded-full text-xs font-medium",a.status==="completed"?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400":a.status==="running"?"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400":a.status==="error"?"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400":"bg-slate-100 text-slate-600 dark:bg-slate-700 dark:text-slate-400"])},m(r.getStatusText(a.status)),3)]))),128))]),r.showLog?(o(),i("div",ue,[t("div",ge,[s[8]||(s[8]=t("h4",{class:"text-sm font-medium text-slate-200"},"Installation Log",-1)),t("button",{onClick:s[0]||(s[0]=a=>r.showLog=!r.showLog),class:"text-slate-400 hover:text-slate-200 transition-colors"},[x(y,{class:"w-4 h-4"})])]),t("div",xe,[(o(!0),i(P,null,R(r.installationLog,(a,e)=>(o(),i("div",{key:e,class:"mb-1"},[t("span",be,"["+m(a.timestamp)+"]",1),t("span",{class:p([r.getLogColor(a.level),"ml-2"])},m(a.message),3)]))),128))])])):b("",!0),r.hasErrors?(o(),i("div",pe,[t("div",he,[x(l,{class:"w-5 h-5 text-red-600 dark:text-red-400 mr-3 mt-0.5"}),t("div",null,[s[9]||(s[9]=t("h4",{class:"text-sm font-medium text-red-800 dark:text-red-200 mb-2"},"Installation Errors",-1)),s[10]||(s[10]=t("p",{class:"text-sm text-red-700 dark:text-red-300 mb-3"}," Some steps failed during installation. You can try to fix the issues and retry. ",-1)),t("button",{onClick:s[1]||(s[1]=(...a)=>r.retryInstallation&&r.retryInstallation(...a)),class:"px-4 py-2 bg-red-600 hover:bg-red-700 text-white text-sm font-medium rounded-lg transition-colors"}," Retry Installation ")])])])):b("",!0),r.installationComplete?(o(),i("div",fe,[t("div",ve,[x(D,{class:"w-5 h-5 text-green-600 dark:text-green-400 mr-3"}),s[11]||(s[11]=t("div",null,[t("h4",{class:"text-sm font-medium text-green-800 dark:text-green-200"},"Installation Complete!"),t("p",{class:"text-sm text-green-700 dark:text-green-300 mt-1"}," Your HelpDesk system has been successfully installed and configured. ")],-1))])])):b("",!0)]),t("div",ke,[!r.installationComplete&&!r.hasErrors?(o(),i("button",{key:0,onClick:s[2]||(s[2]=a=>n.$emit("back")),class:"px-6 py-3 text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white transition-colors"},[x(C,{class:"w-4 h-4 mr-2 inline"}),s[12]||(s[12]=A(" Back ",-1))])):(o(),i("div",_e,[r.hasErrors?(o(),i("button",{key:0,onClick:s[3]||(s[3]=a=>r.showLog=!r.showLog),class:"px-4 py-2 text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white transition-colors"},[x(d,{class:"w-4 h-4 mr-2 inline"}),A(" "+m(r.showLog?"Hide":"Show")+" Log ",1)])):b("",!0),r.installationComplete?(o(),i("button",{key:1,onClick:s[4]||(s[4]=a=>n.$emit("complete")),class:"px-8 py-3 bg-gradient-to-r from-green-600 to-teal-600 hover:from-green-700 hover:to-teal-700 text-white font-semibold rounded-lg transition-all duration-200 transform hover:scale-105 shadow-lg hover:shadow-xl"},[s[13]||(s[13]=A(" Complete Setup ",-1)),x(v,{class:"w-4 h-4 ml-2 inline"})])):b("",!0)]))])])}const Le=H(Q,[["render",we]]);export{Le as default};
