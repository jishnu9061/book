import{D as c,l,u as r,A as g,m as e,z as a,M as A,N as K,o as d,y as w,K as I,L as H,F as T,t as S,E as p,P as ie,J as _e,a8 as ue,R as Ne,p as J,G as z,Z as Ue,a9 as Le,X as Ee,C as Fe}from"./vendor-LkufkiF7.js";import{L as Re}from"./Layout-DdwsTprQ.js";import{h as oe}from"./utils-Cv2kkzzw.js";import{_ as j}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{Clock as Z,AlertTriangle as q,CheckCircle as P,LucideStar as G,LucideTag as W,LucideTrash2 as ae,Edit as Y,LucideUser as R,ArrowRight as xe,Download as fe,Eye as ee,File as re,LucidePaperclip as B,LucideSettings as O,LucideMessageCircle as M,Filter as qe,LucideRefreshCw as ne,List as Ye,Crown as me,LucideShield as he,LucideUsers as Q,LucideX as te,LucideSearch as Oe,Loader2 as se,LucidePlus as be,LucideTicket as le,Info as X,ExternalLink as ve,ChevronUp as Be,ChevronDown as Ve,LucideTrendingUp as ke,BarChart3 as He,CircleX as ge,FileText as Je,EyeOff as Xe,LucideZap as ze,Globe as Ge,Calendar as We,ChevronRight as Qe,LucideShare2 as Ke,Copy as Ze,AlertCircle as et,LucidePrinter as tt}from"./ui-DZ0wy3Ge.js";import"./LogoutButton-CfMbGx4V.js";import"./app-BMhdMQxL.js";import"./Logo-CwTRbPbO.js";import"./FlashMessages-Bge5XBye.js";const st={name:"TimelineItem",components:{MessageCircle:M,Settings:O,Paperclip:B,File:re,Eye:ee,Download:fe,ArrowRight:xe,User:R,Edit:Y,Trash2:ae,Tag:W,Star:G,CheckCircle:P,AlertTriangle:q,Clock:Z},props:{item:{type:Object,required:!0},moment:{type:Function,required:!0}},methods:{getUserInitials(t){if(!t)return"U";const s=t.first_name||"",i=t.last_name||"";return(s.charAt(0)+i.charAt(0)).toUpperCase()||"U"},getUserName(t){return t&&`${t.first_name||""} ${t.last_name||""}`.trim()||"Unknown User"},getActivityIcon(t){return{created:R,updated:Y,assigned:R,status_changed:O,field_changed:Y,commented:M,attachment_added:B,sla_breach:q,sla_applied:P,deleted:ae,tagged:W,favorited:G}[t]||O},formatFieldName(t){return{status_id:"Status",priority_id:"Priority",assigned_to:"Assignment",department_id:"Department",category_id:"Category",type_id:"Type",subject:"Subject",details:"Description",due_date:"Due Date",impact_level:"Impact Level",urgency_level:"Urgency Level",source:"Source",tags:"Tags"}[t]||t.replace(/_/g," ").replace(/\b\w/g,i=>i.toUpperCase())},formatFileSize(t){if(!t)return"0 B";const s=Math.floor(Math.log(t)/Math.log(1024));return(t/Math.pow(1024,s)).toFixed(2)*1+" "+["B","KB","MB","GB","TB"][s]},previewFile(t){console.log("Preview file:",t)},downloadFile(t){const s=document.createElement("a");s.href=window.location.origin+"/files/"+t.filePath,s.download=t.fileName,s.click()}}},at={class:"timeline-item"},it={key:0,class:"bg-slate-50 dark:bg-slate-700/50 rounded-lg p-4 border border-slate-200 dark:border-slate-600"},ot={class:"flex items-start gap-3"},rt={class:"flex-shrink-0"},nt={class:"w-8 h-8 bg-gradient-to-br from-blue-500 to-blue-600 rounded-full flex items-center justify-center text-white font-semibold text-sm"},lt={class:"flex-1 min-w-0"},dt={class:"flex items-center justify-between mb-2"},ct={class:"flex items-center gap-2"},ut={class:"font-medium text-slate-900 dark:text-white text-sm"},mt={key:0,class:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-orange-100 text-orange-800 dark:bg-orange-900/20 dark:text-orange-300"},ht={class:"text-xs text-slate-500 dark:text-slate-400"},gt={class:"prose dark:prose-invert prose-sm max-w-none"},_t=["innerHTML"],xt={key:1,class:"bg-slate-50 dark:bg-slate-700/50 rounded-lg p-4 border border-slate-200 dark:border-slate-600"},ft={class:"flex items-start gap-3"},bt={class:"flex-shrink-0"},vt={class:"w-8 h-8 bg-gradient-to-br from-slate-500 to-slate-600 rounded-full flex items-center justify-center text-white"},kt={class:"flex-1 min-w-0"},pt={class:"flex items-center justify-between mb-2"},yt={class:"flex items-center gap-2"},wt={class:"font-medium text-slate-900 dark:text-white text-sm"},Ct={class:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-slate-100 text-slate-800 dark:bg-slate-600 dark:text-slate-200"},$t={class:"flex items-center gap-2"},Tt={key:0,class:"text-xs text-slate-500 dark:text-slate-400"},St={class:"text-xs text-slate-500 dark:text-slate-400"},At={key:0,class:"mt-3 p-3 bg-white dark:bg-slate-800 rounded border border-slate-200 dark:border-slate-600"},Mt={class:"text-xs text-slate-500 dark:text-slate-400 mb-2"},jt={class:"flex items-center gap-4"},It={class:"flex-1"},Dt={class:"text-xs text-slate-500 dark:text-slate-400 mb-1"},Pt={class:"text-sm text-red-600 dark:text-red-400 bg-red-50 dark:bg-red-900/20 px-2 py-1 rounded"},Nt={class:"flex-shrink-0 text-slate-400 dark:text-slate-500"},Ut={class:"flex-1"},Lt={class:"text-xs text-slate-500 dark:text-slate-400 mb-1"},Et={class:"text-sm text-green-600 dark:text-green-400 bg-green-50 dark:bg-green-900/20 px-2 py-1 rounded"},Ft={key:2,class:"bg-slate-50 dark:bg-slate-700/50 rounded-lg p-4 border border-slate-200 dark:border-slate-600"},Rt={class:"flex items-start gap-3"},qt={class:"flex-shrink-0"},Yt={class:"w-8 h-8 bg-gradient-to-br from-green-500 to-green-600 rounded-full flex items-center justify-center text-white"},Ot={class:"flex-1 min-w-0"},Bt={class:"flex items-center justify-between mb-2"},Vt={class:"flex items-center gap-2"},Ht={class:"font-medium text-slate-900 dark:text-white text-sm"},Jt={class:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-300"},Xt={class:"flex items-center gap-2"},zt={key:0,class:"text-xs text-slate-500 dark:text-slate-400"},Gt={class:"text-xs text-slate-500 dark:text-slate-400"},Wt={class:"mt-3 p-3 bg-white dark:bg-slate-800 rounded border border-slate-200 dark:border-slate-600"},Qt={class:"flex items-center gap-3"},Kt={class:"flex-shrink-0"},Zt={class:"w-10 h-10 bg-blue-100 dark:bg-blue-900/20 rounded-lg flex items-center justify-center"},es={class:"flex-1 min-w-0"},ts={class:"text-sm font-medium text-slate-900 dark:text-white truncate"},ss={class:"text-xs text-slate-500 dark:text-slate-400"},as={class:"flex items-center gap-2"},is=["title"],os=["title"];function rs(t,s,i,b,n,o){const v=c("ArrowRight"),x=c("Paperclip"),_=c("File"),h=c("Eye"),f=c("Download");return r(),l("div",at,[i.item.type==="comment"?(r(),l("div",it,[e("div",ot,[e("div",rt,[e("div",nt,a(o.getUserInitials(i.item.user)),1)]),e("div",lt,[e("div",dt,[e("div",ct,[e("h4",ut,a(o.getUserName(i.item.user)),1),i.item.metadata.isInternal?(r(),l("span",mt,a(t.$t("Internal")),1)):g("",!0)]),e("span",ht,a(i.moment(i.item.timestamp).format("MMM D, YYYY h:mm A")),1)]),e("div",gt,[e("div",{innerHTML:i.item.content},null,8,_t)])])])])):i.item.type==="activity"?(r(),l("div",xt,[e("div",ft,[e("div",bt,[e("div",vt,[(r(),A(K(o.getActivityIcon(i.item.metadata.activityType)),{class:"w-4 h-4"}))])]),e("div",kt,[e("div",pt,[e("div",yt,[e("h4",wt,a(i.item.content),1),e("span",Ct,a(t.$t("System Event")),1)]),e("div",$t,[i.item.user?(r(),l("span",Tt,a(t.$t("by"))+" "+a(o.getUserName(i.item.user)),1)):g("",!0),e("span",St,a(i.moment(i.item.timestamp).format("MMM D, YYYY h:mm A")),1)])]),i.item.metadata.fieldName&&i.item.metadata.oldValue!==i.item.metadata.newValue?(r(),l("div",At,[e("div",Mt,a(t.$t("Field Changed"))+": "+a(o.formatFieldName(i.item.metadata.fieldName)),1),e("div",jt,[e("div",It,[e("div",Dt,a(t.$t("From")),1),e("div",Pt,a(i.item.metadata.oldValue||t.$t("Empty")),1)]),e("div",Nt,[d(v,{class:"w-4 h-4"})]),e("div",Ut,[e("div",Lt,a(t.$t("To")),1),e("div",Et,a(i.item.metadata.newValue||t.$t("Empty")),1)])])])):g("",!0)])])])):i.item.type==="attachment"?(r(),l("div",Ft,[e("div",Rt,[e("div",qt,[e("div",Yt,[d(x,{class:"w-4 h-4"})])]),e("div",Ot,[e("div",Bt,[e("div",Vt,[e("h4",Ht,a(t.$t("Attachment Added")),1),e("span",Jt,a(t.$t("File")),1)]),e("div",Xt,[i.item.user?(r(),l("span",zt,a(t.$t("by"))+" "+a(o.getUserName(i.item.user)),1)):g("",!0),e("span",Gt,a(i.moment(i.item.timestamp).format("MMM D, YYYY h:mm A")),1)])]),e("div",Wt,[e("div",Qt,[e("div",Kt,[e("div",Zt,[d(_,{class:"w-5 h-5 text-blue-600 dark:text-blue-400"})])]),e("div",es,[e("div",ts,a(i.item.metadata.fileName),1),e("div",ss,a(o.formatFileSize(i.item.metadata.fileSize)),1)]),e("div",as,[e("button",{onClick:s[0]||(s[0]=k=>o.previewFile(i.item.metadata)),class:"p-1 text-slate-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors",title:t.$t("Preview")},[d(h,{class:"w-4 h-4"})],8,is),e("button",{onClick:s[1]||(s[1]=k=>o.downloadFile(i.item.metadata)),class:"p-1 text-slate-400 hover:text-green-600 dark:hover:text-green-400 transition-colors",title:t.$t("Download")},[d(f,{class:"w-4 h-4"})],8,os)])])])])])])):g("",!0)])}const ns=j(st,[["render",rs],["__scopeId","data-v-1e5a97e0"]]),ls={name:"CompactTimelineItem",components:{File:re,ArrowRight:xe},props:{item:{type:Object,required:!0},moment:{type:Function,required:!0}},methods:{getUserName(t){return t&&`${t.first_name||""} ${t.last_name||""}`.trim()||"Unknown User"},formatFieldName(t){return{status_id:"Status",priority_id:"Priority",assigned_to:"Assignment",department_id:"Department",category_id:"Category",type_id:"Type",subject:"Subject",details:"Description",due_date:"Due Date",impact_level:"Impact Level",urgency_level:"Urgency Level",source:"Source",tags:"Tags"}[t]||t.replace(/_/g," ").replace(/\b\w/g,i=>i.toUpperCase())},formatFileSize(t){if(!t)return"0 B";const s=Math.floor(Math.log(t)/Math.log(1024));return(t/Math.pow(1024,s)).toFixed(2)*1+" "+["B","KB","MB","GB","TB"][s]},stripHtml(t){if(!t)return"";const s=document.createElement("div");return s.innerHTML=t,s.textContent||s.innerText||""}}},ds={class:"compact-timeline-item"},cs={key:0,class:"bg-slate-50 dark:bg-slate-700/50 rounded-lg p-3 border border-slate-200 dark:border-slate-600"},us={class:"flex items-center justify-between mb-2"},ms={class:"flex items-center gap-2"},hs={class:"font-medium text-slate-900 dark:text-white text-sm"},gs={key:0,class:"inline-flex items-center px-1.5 py-0.5 rounded-full text-xs font-medium bg-orange-100 text-orange-800 dark:bg-orange-900/20 dark:text-orange-300"},_s={class:"text-xs text-slate-500 dark:text-slate-400"},xs={class:"text-sm text-slate-700 dark:text-slate-300 line-clamp-2"},fs={key:1,class:"bg-slate-50 dark:bg-slate-700/50 rounded-lg p-3 border border-slate-200 dark:border-slate-600"},bs={class:"flex items-center justify-between mb-2"},vs={class:"flex items-center gap-2"},ks={class:"font-medium text-slate-900 dark:text-white text-sm"},ps={class:"inline-flex items-center px-1.5 py-0.5 rounded-full text-xs font-medium bg-slate-100 text-slate-800 dark:bg-slate-600 dark:text-slate-200"},ys={class:"flex items-center gap-2"},ws={key:0,class:"text-xs text-slate-500 dark:text-slate-400"},Cs={class:"text-xs text-slate-500 dark:text-slate-400"},$s={key:0,class:"text-xs text-slate-600 dark:text-slate-400"},Ts={class:"text-red-600 dark:text-red-400"},Ss={class:"text-green-600 dark:text-green-400"},As={key:2,class:"bg-slate-50 dark:bg-slate-700/50 rounded-lg p-3 border border-slate-200 dark:border-slate-600"},Ms={class:"flex items-center justify-between mb-2"},js={class:"flex items-center gap-2"},Is={class:"font-medium text-slate-900 dark:text-white text-sm"},Ds={class:"inline-flex items-center px-1.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-300"},Ps={class:"flex items-center gap-2"},Ns={key:0,class:"text-xs text-slate-500 dark:text-slate-400"},Us={class:"text-xs text-slate-500 dark:text-slate-400"},Ls={class:"flex items-center gap-2"},Es={class:"text-sm text-slate-700 dark:text-slate-300 truncate"},Fs={class:"text-xs text-slate-500 dark:text-slate-400"};function Rs(t,s,i,b,n,o){const v=c("ArrowRight"),x=c("File");return r(),l("div",ds,[i.item.type==="comment"?(r(),l("div",cs,[e("div",us,[e("div",ms,[e("h4",hs,a(o.getUserName(i.item.user)),1),i.item.metadata.isInternal?(r(),l("span",gs,a(t.$t("Internal")),1)):g("",!0)]),e("span",_s,a(i.moment(i.item.timestamp).format("MMM D, h:mm A")),1)]),e("div",xs,a(o.stripHtml(i.item.content)),1)])):i.item.type==="activity"?(r(),l("div",fs,[e("div",bs,[e("div",vs,[e("h4",ks,a(i.item.content),1),e("span",ps,a(t.$t("System")),1)]),e("div",ys,[i.item.user?(r(),l("span",ws,a(o.getUserName(i.item.user)),1)):g("",!0),e("span",Cs,a(i.moment(i.item.timestamp).format("MMM D, h:mm A")),1)])]),i.item.metadata.fieldName&&i.item.metadata.oldValue!==i.item.metadata.newValue?(r(),l("div",$s,[w(a(o.formatFieldName(i.item.metadata.fieldName))+": ",1),e("span",Ts,a(i.item.metadata.oldValue||t.$t("Empty")),1),d(v,{class:"w-3 h-3 inline mx-1"}),e("span",Ss,a(i.item.metadata.newValue||t.$t("Empty")),1)])):g("",!0)])):i.item.type==="attachment"?(r(),l("div",As,[e("div",Ms,[e("div",js,[e("h4",Is,a(t.$t("Attachment Added")),1),e("span",Ds,a(t.$t("File")),1)]),e("div",Ps,[i.item.user?(r(),l("span",Ns,a(o.getUserName(i.item.user)),1)):g("",!0),e("span",Us,a(i.moment(i.item.timestamp).format("MMM D, h:mm A")),1)])]),e("div",Ls,[d(x,{class:"w-4 h-4 text-slate-400"}),e("span",Es,a(i.item.metadata.fileName),1),e("span",Fs," ("+a(o.formatFileSize(i.item.metadata.fileSize))+") ",1)])])):g("",!0)])}const qs=j(ls,[["render",Rs],["__scopeId","data-v-e00a7006"]]),Ys={name:"TicketTimeline",components:{TimelineItem:ns,CompactTimelineItem:qs,MessageCircle:M,Eye:ee,List:Ye,RefreshCw:ne,Filter:qe,User:R,Settings:O,Paperclip:B,CheckCircle:P,AlertTriangle:q,Clock:Z,Edit:Y,Trash2:ae,Tag:W,Star:G},props:{comments:{type:Array,default:()=>[]},activities:{type:Array,default:()=>[]},attachments:{type:Array,default:()=>[]}},data(){return{moment:oe,timelineView:"timeline",showFilter:!1,filters:{comments:!0,activities:!0,attachments:!0}}},computed:{timelineItems(){const t=[];return this.comments.forEach(s=>{t.push({type:"comment",id:s.id,timestamp:s.created_at,user:s.user,content:s.details,metadata:{isInternal:s.is_internal||!1}})}),this.activities.forEach(s=>{t.push({type:"activity",id:s.id,timestamp:s.created_at,user:s.user,content:s.description,metadata:{activityType:s.activity_type,fieldName:s.field_name,oldValue:s.old_value,newValue:s.new_value,metadata:s.metadata}})}),this.attachments.forEach(s=>{t.push({type:"attachment",id:s.id,timestamp:s.created_at,user:s.user,content:s.name,metadata:{fileName:s.name,fileSize:s.size,filePath:s.path}})}),t.sort((s,i)=>new Date(s.timestamp)-new Date(i.timestamp))},filteredTimelineItems(){return this.timelineItems.filter(t=>{switch(t.type){case"comment":return this.filters.comments;case"activity":return this.filters.activities;case"attachment":return this.filters.attachments;default:return!0}})}},methods:{toggleTimelineView(){this.timelineView=this.timelineView==="timeline"?"compact":"timeline"},refreshTimeline(){this.$emit("refresh")},toggleFilter(){this.showFilter=!this.showFilter},getTimelineDotClass(t){const s="bg-white dark:bg-slate-800";switch(t){case"comment":return`${s} border-blue-500`;case"activity":return`${s} border-slate-500`;case"attachment":return`${s} border-green-500`;default:return`${s} border-slate-400`}},getTimelineDotInnerClass(t){switch(t){case"comment":return"bg-blue-500";case"activity":return"bg-slate-500";case"attachment":return"bg-green-500";default:return"bg-slate-400"}},getTimelineAvatarClass(t){switch(t){case"comment":return"bg-gradient-to-br from-blue-500 to-blue-600";case"activity":return"bg-gradient-to-br from-slate-500 to-slate-600";case"attachment":return"bg-gradient-to-br from-green-500 to-green-600";default:return"bg-gradient-to-br from-slate-400 to-slate-500"}},getTimelineIcon(t){switch(t){case"comment":return M;case"activity":return O;case"attachment":return B;default:return R}}}},Os={class:"ticket-timeline"},Bs={class:"px-6 py-4 bg-gradient-to-r from-slate-50 to-slate-100/50 dark:from-slate-700/50 dark:to-slate-800/50 border-b border-slate-200 dark:border-slate-700"},Vs={class:"flex items-center justify-between"},Hs={class:"text-xl font-semibold text-slate-900 dark:text-white flex items-center gap-2"},Js={class:"flex items-center gap-2"},Xs=["title"],zs=["title"],Gs=["title"],Ws={key:0,class:"px-6 py-4 bg-slate-50 dark:bg-slate-700/50 border-b border-slate-200 dark:border-slate-700"},Qs={class:"flex flex-wrap gap-4"},Ks={class:"flex items-center gap-2"},Zs={for:"filter-comments",class:"text-sm text-slate-700 dark:text-slate-300"},ea={class:"flex items-center gap-2"},ta={for:"filter-activities",class:"text-sm text-slate-700 dark:text-slate-300"},sa={class:"flex items-center gap-2"},aa={for:"filter-attachments",class:"text-sm text-slate-700 dark:text-slate-300"},ia={class:"p-6"},oa={key:0,class:"relative"},ra={class:"space-y-6"},na={class:"ml-12"},la={key:1,class:"space-y-4"},da={class:"flex-shrink-0"},ca={class:"flex-1"},ua={key:2,class:"text-center py-8 text-slate-500 dark:text-slate-400"};function ma(t,s,i,b,n,o){const v=c("MessageCircle"),x=c("Eye"),_=c("List"),h=c("RefreshCw"),f=c("Filter"),k=c("TimelineItem"),C=c("CompactTimelineItem");return r(),l("div",Os,[e("div",Bs,[e("div",Vs,[e("h2",Hs,[d(v,{class:"w-5 h-5"}),w(" "+a(t.$t("Ticket Activity Log")),1)]),e("div",Js,[e("button",{onClick:s[0]||(s[0]=(...u)=>o.toggleTimelineView&&o.toggleTimelineView(...u)),class:"p-1 text-slate-400 hover:text-slate-600 dark:hover:text-slate-300 transition-colors",title:t.$t("Toggle View")},[n.timelineView==="compact"?(r(),A(x,{key:0,class:"w-4 h-4"})):(r(),A(_,{key:1,class:"w-4 h-4"}))],8,Xs),e("button",{onClick:s[1]||(s[1]=(...u)=>o.refreshTimeline&&o.refreshTimeline(...u)),class:"p-1 text-slate-400 hover:text-slate-600 dark:hover:text-slate-300 transition-colors",title:t.$t("Refresh")},[d(h,{class:"w-4 h-4"})],8,zs),e("button",{onClick:s[2]||(s[2]=(...u)=>o.toggleFilter&&o.toggleFilter(...u)),class:"p-1 text-slate-400 hover:text-slate-600 dark:hover:text-slate-300 transition-colors",title:t.$t("Filter")},[d(f,{class:"w-4 h-4"})],8,Gs)])])]),n.showFilter?(r(),l("div",Ws,[e("div",Qs,[e("div",Ks,[I(e("input",{"onUpdate:modelValue":s[3]||(s[3]=u=>n.filters.comments=u),type:"checkbox",id:"filter-comments",class:"rounded border-slate-300 text-blue-600 focus:ring-blue-500"},null,512),[[H,n.filters.comments]]),e("label",Zs,a(t.$t("Comments")),1)]),e("div",ea,[I(e("input",{"onUpdate:modelValue":s[4]||(s[4]=u=>n.filters.activities=u),type:"checkbox",id:"filter-activities",class:"rounded border-slate-300 text-blue-600 focus:ring-blue-500"},null,512),[[H,n.filters.activities]]),e("label",ta,a(t.$t("System Events")),1)]),e("div",sa,[I(e("input",{"onUpdate:modelValue":s[5]||(s[5]=u=>n.filters.attachments=u),type:"checkbox",id:"filter-attachments",class:"rounded border-slate-300 text-blue-600 focus:ring-blue-500"},null,512),[[H,n.filters.attachments]]),e("label",aa,a(t.$t("Attachments")),1)])])])):g("",!0),e("div",ia,[n.timelineView==="timeline"?(r(),l("div",oa,[s[6]||(s[6]=e("div",{class:"absolute left-6 top-0 bottom-0 w-0.5 bg-slate-200 dark:bg-slate-700"},null,-1)),e("div",ra,[(r(!0),l(T,null,S(o.filteredTimelineItems,(u,m)=>(r(),l("div",{key:`${u.type}-${u.id||m}`,class:"relative"},[e("div",{class:p(["absolute left-4 w-4 h-4 rounded-full border-2 border-white dark:border-slate-800 shadow-sm",o.getTimelineDotClass(u.type)])},[e("div",{class:p(["w-full h-full rounded-full",o.getTimelineDotInnerClass(u.type)])},null,2)],2),e("div",na,[d(k,{item:u,moment:n.moment},null,8,["item","moment"])])]))),128))])])):(r(),l("div",la,[(r(!0),l(T,null,S(o.filteredTimelineItems,(u,m)=>(r(),l("div",{key:`${u.type}-${u.id||m}`,class:"flex gap-4"},[e("div",da,[e("div",{class:p(["w-10 h-10 rounded-full flex items-center justify-center text-white font-semibold",o.getTimelineAvatarClass(u.type)])},[(r(),A(K(o.getTimelineIcon(u.type)),{class:"w-5 h-5"}))],2)]),e("div",ca,[d(C,{item:u,moment:n.moment},null,8,["item","moment"])])]))),128))])),o.filteredTimelineItems.length===0?(r(),l("div",ua,[d(v,{class:"w-12 h-12 mx-auto mb-4 text-slate-300 dark:text-slate-600"}),e("p",null,a(t.$t("No activity yet")),1)])):g("",!0)])])}const ha=j(Ys,[["render",ma],["__scopeId","data-v-1c1c9598"]]),ga={name:"ParticipantSelector",components:{Search:Oe,X:te,Users:Q,User:R,Shield:he,Crown:me},props:{users:{type:Array,default:()=>[]},selectedParticipants:{type:Array,default:()=>[]},excludeUsers:{type:Array,default:()=>[]}},data(){return{searchQuery:"",activeFilter:"all",filters:[{key:"all",label:"All",icon:Q},{key:"admin",label:"Admins",icon:me},{key:"manager",label:"Managers",icon:he},{key:"agent",label:"Agents",icon:R}]}},computed:{filteredUsers(){let t=this.users.filter(s=>!this.excludeUsers.includes(s.id));if(this.searchQuery){const s=this.searchQuery.toLowerCase();t=t.filter(i=>i.name.toLowerCase().includes(s)||i.email.toLowerCase().includes(s))}return this.activeFilter!=="all"&&(t=t.filter(s=>s.role===this.activeFilter)),t}},methods:{toggleParticipant(t){this.isSelected(t.id)?this.removeParticipant(t.id):this.addParticipant(t)},addParticipant(t){this.isSelected(t.id)||this.$emit("add-participant",{...t,role:this.getDefaultRole(t.role)})},removeParticipant(t){this.$emit("remove-participant",t)},selectAll(){this.filteredUsers.filter(s=>!this.isSelected(s.id)).forEach(s=>this.addParticipant(s))},clearAll(){this.$emit("clear-all")},clearSearch(){this.searchQuery=""},isSelected(t){return this.selectedParticipants.some(s=>s.id===t)},getInitials(t){return t?t.split(" ").map(s=>s.charAt(0)).join("").toUpperCase().substring(0,2):"U"},getRoleClass(t){return{admin:"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-300",manager:"bg-orange-100 text-orange-800 dark:bg-orange-900/20 dark:text-orange-300",agent:"bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-300"}[t]||"bg-slate-100 text-slate-800 dark:bg-slate-600 dark:text-slate-200"},getDefaultRole(t){return{admin:"participant",manager:"participant",agent:"agent"}[t]||"participant"},getFilterCount(t){return t==="all"?this.users.filter(s=>!this.excludeUsers.includes(s.id)).length:this.users.filter(s=>s.role===t&&!this.excludeUsers.includes(s.id)).length}}},_a={class:"participant-selector"},xa={class:"relative mb-4"},fa=["placeholder"],ba={class:"flex space-x-1 mb-4 bg-slate-100 dark:bg-slate-700 rounded-lg p-1"},va=["onClick"],ka={key:0,class:"ml-1 inline-flex items-center px-1.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-300"},pa={key:0,class:"mb-4"},ya={class:"text-sm font-medium text-slate-900 dark:text-white mb-2"},wa={class:"flex flex-wrap gap-2"},Ca={class:"w-6 h-6 bg-gradient-to-br from-blue-500 to-blue-600 rounded-full flex items-center justify-center text-white text-xs font-semibold"},$a={class:"text-xs opacity-75 capitalize"},Ta=["onClick"],Sa={class:"max-h-64 overflow-y-auto space-y-1"},Aa=["onClick"],Ma={class:"flex-shrink-0"},ja=["id","checked","onChange"],Ia={class:"w-8 h-8 bg-gradient-to-br from-slate-500 to-slate-600 rounded-full flex items-center justify-center text-white text-sm font-semibold"},Da={class:"flex-1 min-w-0"},Pa={class:"text-sm font-medium text-slate-900 dark:text-white truncate"},Na={class:"text-xs text-slate-500 dark:text-slate-400 truncate"},Ua={class:"flex-shrink-0"},La={key:1,class:"text-center py-8 text-slate-500 dark:text-slate-400"},Ea={class:"text-sm"},Fa={key:2,class:"mt-4 pt-4 border-t border-slate-200 dark:border-slate-600"},Ra={class:"flex items-center justify-between"},qa={class:"text-sm text-slate-600 dark:text-slate-400"},Ya={class:"flex gap-2"};function Oa(t,s,i,b,n,o){const v=c("Search"),x=c("X"),_=c("Users");return r(),l("div",_a,[e("div",xa,[d(v,{class:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-slate-400"}),I(e("input",{"onUpdate:modelValue":s[0]||(s[0]=h=>n.searchQuery=h),type:"text",class:"w-full pl-10 pr-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-slate-700 dark:text-white",placeholder:t.$t("Search users...")},null,8,fa),[[ie,n.searchQuery]]),n.searchQuery?(r(),l("button",{key:0,onClick:s[1]||(s[1]=(...h)=>o.clearSearch&&o.clearSearch(...h)),class:"absolute right-3 top-1/2 transform -translate-y-1/2 text-slate-400 hover:text-slate-600 dark:hover:text-slate-300"},[d(x,{class:"w-4 h-4"})])):g("",!0)]),e("div",ba,[(r(!0),l(T,null,S(n.filters,h=>(r(),l("button",{key:h.key,onClick:f=>n.activeFilter=h.key,class:p(["flex-1 px-3 py-1.5 text-sm font-medium rounded-md transition-colors",n.activeFilter===h.key?"bg-white dark:bg-slate-600 text-slate-900 dark:text-white shadow-sm":"text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white"])},[(r(),A(K(h.icon),{class:"w-4 h-4 inline mr-2"})),w(" "+a(h.label)+" ",1),o.getFilterCount(h.key)>0?(r(),l("span",ka,a(o.getFilterCount(h.key)),1)):g("",!0)],10,va))),128))]),i.selectedParticipants.length>0?(r(),l("div",pa,[e("h4",ya,a(t.$t("Selected Participants")),1),e("div",wa,[(r(!0),l(T,null,S(i.selectedParticipants,h=>(r(),l("div",{key:h.id,class:"flex items-center gap-2 px-3 py-1.5 bg-blue-100 dark:bg-blue-900/20 text-blue-800 dark:text-blue-300 rounded-lg text-sm"},[e("div",Ca,a(o.getInitials(h.name)),1),e("span",null,a(h.name),1),e("span",$a,a(h.role),1),e("button",{onClick:f=>o.removeParticipant(h.id),class:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200"},[d(x,{class:"w-3 h-3"})],8,Ta)]))),128))])])):g("",!0),e("div",Sa,[(r(!0),l(T,null,S(o.filteredUsers,h=>(r(),l("div",{key:h.id,class:p(["flex items-center gap-3 p-3 rounded-lg border border-slate-200 dark:border-slate-600 hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors cursor-pointer",{"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800":o.isSelected(h.id)}]),onClick:f=>o.toggleParticipant(h)},[e("div",Ma,[e("input",{id:`user-${h.id}`,type:"checkbox",checked:o.isSelected(h.id),class:"rounded border-slate-300 text-blue-600 focus:ring-blue-500",onChange:f=>o.toggleParticipant(h)},null,40,ja)]),e("div",Ia,a(o.getInitials(h.name)),1),e("div",Da,[e("div",Pa,a(h.name),1),e("div",Na,a(h.email),1)]),e("div",Ua,[e("span",{class:p(["inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium",o.getRoleClass(h.role)])},a(h.role),3)])],10,Aa))),128))]),o.filteredUsers.length===0?(r(),l("div",La,[d(_,{class:"w-8 h-8 mx-auto mb-2 text-slate-300 dark:text-slate-600"}),e("p",Ea,a(t.$t("No users found")),1)])):g("",!0),i.selectedParticipants.length>0?(r(),l("div",Fa,[e("div",Ra,[e("div",qa,a(i.selectedParticipants.length)+" "+a(t.$t("participants selected")),1),e("div",Ya,[e("button",{onClick:s[2]||(s[2]=(...h)=>o.selectAll&&o.selectAll(...h)),class:"text-xs text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200"},a(t.$t("Select All")),1),e("button",{onClick:s[3]||(s[3]=(...h)=>o.clearAll&&o.clearAll(...h)),class:"text-xs text-slate-600 dark:text-slate-400 hover:text-slate-800 dark:hover:text-slate-200"},a(t.$t("Clear All")),1)])])])):g("",!0)])}const Ba=j(ga,[["render",Oa],["__scopeId","data-v-8b2ef375"]]),Va={name:"ConversationStarter",components:{MessageCircle:M,X:te,Ticket:le,CheckCircle:P,Plus:be,Loader2:se,ParticipantSelector:Ba},props:{show:{type:Boolean,default:!1},ticket:{type:Object,required:!0},availableUsers:{type:Array,default:()=>[]}},data(){var t,s,i,b,n,o;return{loading:!1,form:{conversation_type:"internal",include_assigned_agent:!0,additional_participants:[],initial_message:""},additionalParticipants:[],quickTemplates:[{id:"status_update",title:"Status Update",description:"Inform about ticket status changes",message:`Hi,

I wanted to update you on the status of ticket #${(t=this.ticket)==null?void 0:t.uid}.

Current Status: ${(i=(s=this.ticket)==null?void 0:s.status)==null?void 0:i.name}

Please let me know if you have any questions.

Best regards`},{id:"information_request",title:"Information Request",description:"Request additional information from customer",message:`Hi,

Thank you for contacting us regarding ticket #${(b=this.ticket)==null?void 0:b.uid}.

To better assist you, I need some additional information:

1. [Specific question 1]
2. [Specific question 2]
3. [Specific question 3]

Please provide these details so I can resolve your issue quickly.

Best regards`},{id:"resolution_update",title:"Resolution Update",description:"Provide resolution or next steps",message:`Hi,

I have an update on ticket #${(n=this.ticket)==null?void 0:n.uid}.

[Resolution details or next steps]

Please let me know if this resolves your issue or if you need any clarification.

Best regards`},{id:"escalation",title:"Escalation Notice",description:"Inform about ticket escalation",message:`Hi,

I wanted to inform you that ticket #${(o=this.ticket)==null?void 0:o.uid} has been escalated to our senior team for review.

This is due to: [Reason for escalation]

We will provide an update within [timeframe].

Best regards`}]}},computed:{canStartConversation(){return this.form.initial_message.trim().length>0&&!this.loading},excludedUserIds(){const t=[this.ticket.user_id];return this.ticket.assigned_to&&this.form.include_assigned_agent&&t.push(this.ticket.assigned_to),t}},methods:{closeModal(){this.$emit("close"),this.resetForm()},resetForm(){this.form={conversation_type:"internal",include_assigned_agent:!0,additional_participants:[],initial_message:""},this.additionalParticipants=[],this.loading=!1},addParticipant(t){this.additionalParticipants.find(s=>s.id===t.id)||this.additionalParticipants.push(t)},removeParticipant(t){this.additionalParticipants=this.additionalParticipants.filter(s=>s.id!==t)},clearAdditionalParticipants(){this.additionalParticipants=[]},getInitials(t){return t?t.split(" ").map(s=>s.charAt(0)).join("").toUpperCase().substring(0,2):"U"},applyTemplate(t){this.form.initial_message=t.message},async startConversation(){var t,s;if(this.canStartConversation){this.loading=!0;try{const i={ticket_id:this.ticket.id,conversation_type:this.form.conversation_type,participants:this.getParticipants(),initial_message:this.form.initial_message,context:{ticket_uid:this.ticket.uid,ticket_subject:this.ticket.subject,ticket_status:(t=this.ticket.status)==null?void 0:t.name}},b=(s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.getAttribute("content");if(!b)throw new Error("CSRF token not found");const n=await fetch("/conversations",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":b,"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(i)});let o=n.headers.get("content-type")||"";const v=o.includes("application/json"),x=await n.text();let _=null;if(console.log("Conversation creation response:",{status:n.status,statusText:n.statusText,contentType:o,isJson:v,responseText:x.substring(0,200)}),v||x.trim().startsWith("{"))try{_=JSON.parse(x),console.log("Parsed JSON result:",_)}catch(h){console.warn("Failed to parse response as JSON:",h,"Response text:",x)}if(!n.ok)if(_){if(n.status===422&&_.errors){const f=Object.values(_.errors).flat().join(", ");throw new Error(f||_.message||"Validation failed")}const h=_.message||_.error||(_.errors?JSON.stringify(_.errors):"")||`Server error: ${n.status}`;throw console.error("Server returned error:",_),new Error(h)}else throw console.error("Server returned non-JSON error:",x.substring(0,500)),new Error(`Server error (${n.status}): ${n.statusText||"Unknown error"}`);if(!_)if(v)try{_=JSON.parse(x),console.log("Parsed JSON result (retry):",_)}catch(h){throw console.error("Failed to parse JSON response:",h,"Response text:",x),new Error("Invalid response format: expected JSON but received: "+x.substring(0,100))}else throw console.error("Response is not JSON but status is OK:",{contentType:o,responseText:x.substring(0,200)}),new Error("Invalid response format: expected JSON, received "+o);if(!_)throw console.error("Result is null after parsing:",{responseText:x,isJson:v,contentType:o}),new Error("Invalid response format: could not parse response");if(_.success)console.log("Conversation created successfully:",_),this.$emit("conversation-created",_.data),this.closeModal();else{console.error("Server returned success=false:",_);const h=_.message||_.error||"Failed to start conversation";throw new Error(h)}}catch(i){console.error("Error starting conversation:",i),console.error("Error details:",{message:i.message,stack:i.stack,response:i.response});const b=i.message||"An unexpected error occurred while starting the conversation";this.$emit("conversation-error",b)}finally{this.loading=!1}}},getParticipants(){const t=[{user_id:this.ticket.user_id,role:"customer",required:!0}];return this.form.include_assigned_agent&&this.ticket.assigned_to&&t.push({user_id:this.ticket.assigned_to,role:"agent",required:!1}),this.additionalParticipants.forEach(s=>{t.push({user_id:s.id,role:s.role||"participant",required:!1})}),t}}},Ha={key:0,class:"fixed inset-0 z-50 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},Ja={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},Xa={class:"inline-block align-bottom bg-white dark:bg-slate-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-2xl sm:w-full"},za={class:"bg-gradient-to-r from-blue-600 to-indigo-600 px-6 py-4"},Ga={class:"flex items-center justify-between"},Wa={class:"text-lg font-semibold text-white flex items-center gap-2"},Qa={class:"px-6 py-6"},Ka={class:"mb-6 p-4 bg-slate-50 dark:bg-slate-700 rounded-lg border border-slate-200 dark:border-slate-600"},Za={class:"text-sm font-medium text-slate-900 dark:text-white mb-2"},ei={class:"text-sm text-slate-600 dark:text-slate-400"},ti={class:"flex items-center gap-2 mb-1"},si={class:"font-medium"},ai={class:"text-xs text-slate-500 dark:text-slate-500"},ii={class:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2"},oi={class:"grid grid-cols-2 gap-4"},ri={class:"flex items-center gap-3"},ni={key:0,class:"w-2 h-2 bg-white rounded-full mx-auto mt-0.5"},li={class:"text-sm font-medium text-slate-900 dark:text-white"},di={class:"text-xs text-slate-500 dark:text-slate-400"},ci={class:"flex items-center gap-3"},ui={key:0,class:"w-2 h-2 bg-white rounded-full mx-auto mt-0.5"},mi={class:"text-sm font-medium text-slate-900 dark:text-white"},hi={class:"text-xs text-slate-500 dark:text-slate-400"},gi={class:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2"},_i={class:"space-y-2"},xi={class:"flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-700 rounded-lg"},fi={class:"flex items-center gap-3"},bi={class:"w-8 h-8 bg-gradient-to-br from-blue-500 to-blue-600 rounded-full flex items-center justify-center text-white text-sm font-semibold"},vi={class:"text-sm font-medium text-slate-900 dark:text-white"},ki={class:"text-xs text-slate-500 dark:text-slate-400"},pi={class:"flex items-center gap-2"},yi={class:"text-xs text-slate-500 dark:text-slate-400"},wi={key:0,class:"flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-700 rounded-lg"},Ci={class:"flex items-center gap-3"},$i={class:"w-8 h-8 bg-gradient-to-br from-green-500 to-green-600 rounded-full flex items-center justify-center text-white text-sm font-semibold"},Ti={class:"text-sm font-medium text-slate-900 dark:text-white"},Si={class:"text-xs text-slate-500 dark:text-slate-400"},Ai={class:"flex items-center gap-2"},Mi={class:"text-xs text-slate-500 dark:text-slate-400"},ji={class:"border-t border-slate-200 dark:border-slate-600 pt-3"},Ii={class:"flex items-center gap-2 mb-3"},Di={class:"text-sm font-medium text-slate-700 dark:text-slate-300"},Pi={class:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2"},Ni={class:"relative"},Ui=["placeholder"],Li={class:"absolute bottom-2 right-2 text-xs text-slate-400"},Ei={class:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2"},Fi={class:"grid grid-cols-1 gap-2"},Ri=["onClick"],qi={class:"text-sm font-medium text-slate-900 dark:text-white"},Yi={class:"text-xs text-slate-500 dark:text-slate-400"},Oi={class:"flex items-center justify-end gap-3 pt-4 border-t border-slate-200 dark:border-slate-600"},Bi=["disabled"],Vi={key:0,class:"flex items-center gap-2"},Hi={key:1,class:"flex items-center gap-2"};function Ji(t,s,i,b,n,o){var u;const v=c("MessageCircle"),x=c("X"),_=c("Ticket"),h=c("CheckCircle"),f=c("Plus"),k=c("ParticipantSelector"),C=c("Loader2");return i.show?(r(),l("div",Ha,[e("div",Ja,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true",onClick:s[0]||(s[0]=(...m)=>o.closeModal&&o.closeModal(...m))}),e("div",Xa,[e("div",za,[e("div",Ga,[e("h3",Wa,[d(v,{class:"w-5 h-5"}),w(" "+a(t.$t("Start Conversation")),1)]),e("button",{onClick:s[1]||(s[1]=(...m)=>o.closeModal&&o.closeModal(...m)),class:"text-white hover:text-gray-200 transition-colors"},[d(x,{class:"w-6 h-6"})])])]),e("div",Qa,[e("div",Ka,[e("h4",Za,a(t.$t("Ticket Context")),1),e("div",ei,[e("div",ti,[d(_,{class:"w-4 h-4"}),e("span",si,"#"+a(i.ticket.uid),1),e("span",null,a(i.ticket.subject),1)]),e("div",ai,a(t.$t("Customer"))+": "+a(i.ticket.user)+" | "+a(t.$t("Status"))+": "+a((u=i.ticket.status)==null?void 0:u.name),1)])]),e("form",{onSubmit:s[7]||(s[7]=_e((...m)=>o.startConversation&&o.startConversation(...m),["prevent"])),class:"space-y-6"},[e("div",null,[e("label",ii,a(t.$t("Conversation Type")),1),e("div",oi,[e("label",{class:p(["relative flex items-center p-4 border border-slate-200 dark:border-slate-600 rounded-lg cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors",n.form.conversation_type==="internal"?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":""])},[I(e("input",{"onUpdate:modelValue":s[2]||(s[2]=m=>n.form.conversation_type=m),type:"radio",value:"internal",class:"sr-only"},null,512),[[ue,n.form.conversation_type]]),e("div",ri,[e("div",{class:p(["w-4 h-4 border-2 rounded-full",n.form.conversation_type==="internal"?"border-blue-500 bg-blue-500":"border-slate-300"])},[n.form.conversation_type==="internal"?(r(),l("div",ni)):g("",!0)],2),e("div",null,[e("div",li,a(t.$t("Internal")),1),e("div",di,a(t.$t("Team discussion only")),1)])])],2),e("label",{class:p(["relative flex items-center p-4 border border-slate-200 dark:border-slate-600 rounded-lg cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors",n.form.conversation_type==="customer"?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":""])},[I(e("input",{"onUpdate:modelValue":s[3]||(s[3]=m=>n.form.conversation_type=m),type:"radio",value:"customer",class:"sr-only"},null,512),[[ue,n.form.conversation_type]]),e("div",ci,[e("div",{class:p(["w-4 h-4 border-2 rounded-full",n.form.conversation_type==="customer"?"border-blue-500 bg-blue-500":"border-slate-300"])},[n.form.conversation_type==="customer"?(r(),l("div",ui)):g("",!0)],2),e("div",null,[e("div",mi,a(t.$t("Customer")),1),e("div",hi,a(t.$t("Visible to customer")),1)])])],2)])]),e("div",null,[e("label",gi,a(t.$t("Participants")),1),e("div",_i,[e("div",xi,[e("div",fi,[e("div",bi,a(o.getInitials(i.ticket.user)),1),e("div",null,[e("div",vi,a(i.ticket.user),1),e("div",ki,a(t.$t("Customer")),1)])]),e("div",pi,[e("span",yi,a(t.$t("Required")),1),d(h,{class:"w-4 h-4 text-green-500"})])]),i.ticket.assigned_user?(r(),l("div",wi,[e("div",Ci,[e("div",$i,a(o.getInitials(i.ticket.assigned_user)),1),e("div",null,[e("div",Ti,a(i.ticket.assigned_user),1),e("div",Si,a(t.$t("Assigned Agent")),1)])]),e("div",Ai,[I(e("input",{"onUpdate:modelValue":s[4]||(s[4]=m=>n.form.include_assigned_agent=m),type:"checkbox",class:"rounded border-slate-300 text-blue-600 focus:ring-blue-500"},null,512),[[H,n.form.include_assigned_agent]]),e("span",Mi,a(t.$t("Optional")),1)])])):g("",!0),e("div",ji,[e("div",Ii,[d(f,{class:"w-4 h-4 text-slate-400"}),e("span",Di,a(t.$t("Add Participants")),1)]),d(k,{users:i.availableUsers,"selected-participants":n.additionalParticipants,"exclude-users":o.excludedUserIds,onAddParticipant:o.addParticipant,onRemoveParticipant:o.removeParticipant,onClearAll:o.clearAdditionalParticipants},null,8,["users","selected-participants","exclude-users","onAddParticipant","onRemoveParticipant","onClearAll"])])])]),e("div",null,[e("label",Pi,a(t.$t("Initial Message")),1),e("div",Ni,[I(e("textarea",{"onUpdate:modelValue":s[5]||(s[5]=m=>n.form.initial_message=m),rows:"4",class:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-slate-700 dark:text-white",placeholder:t.$t("Type your initial message here...")},null,8,Ui),[[ie,n.form.initial_message]]),e("div",Li,a(n.form.initial_message.length)+"/500 ",1)])]),e("div",null,[e("label",Ei,a(t.$t("Quick Templates")),1),e("div",Fi,[(r(!0),l(T,null,S(n.quickTemplates,m=>(r(),l("button",{key:m.id,type:"button",onClick:D=>o.applyTemplate(m),class:"text-left p-3 border border-slate-200 dark:border-slate-600 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors"},[e("div",qi,a(m.title),1),e("div",Yi,a(m.description),1)],8,Ri))),128))])]),e("div",Oi,[e("button",{type:"button",onClick:s[6]||(s[6]=(...m)=>o.closeModal&&o.closeModal(...m)),class:"px-4 py-2 text-sm font-medium text-slate-700 dark:text-slate-300 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-600 transition-colors"},a(t.$t("Cancel")),1),e("button",{type:"submit",disabled:!o.canStartConversation,class:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},[n.loading?(r(),l("div",Vi,[d(C,{class:"w-4 h-4 animate-spin"}),w(" "+a(t.$t("Starting...")),1)])):(r(),l("div",Hi,[d(v,{class:"w-4 h-4"}),w(" "+a(t.$t("Start Conversation")),1)]))],8,Bi)])],32)])])])])):g("",!0)}const Xi=j(Va,[["render",Ji],["__scopeId","data-v-3c1cafa5"]]),zi={name:"CustomerConversationStarter",components:{MessageCircle:M,X:te,Ticket:le,CheckCircle:P,Loader2:se,Users:Q,Info:X},props:{show:{type:Boolean,default:!1},ticket:{type:Object,required:!0},user:{type:Object,required:!0}},data(){var t,s,i,b;return{loading:!1,form:{conversation_type:"customer",initial_message:""},customerTemplates:[{id:"general_question",title:"General Question",description:"Ask a general question about your ticket",message:`Hi,

I have a question about ticket #${(t=this.ticket)==null?void 0:t.uid}.

[Your question here]

Thank you for your help!`},{id:"status_inquiry",title:"Status Inquiry",description:"Ask about the current status of your ticket",message:`Hi,

Could you please provide an update on the status of ticket #${(s=this.ticket)==null?void 0:s.uid}?

I would like to know:
- Current status
- Expected resolution time
- Any additional information needed

Thank you!`},{id:"additional_info",title:"Provide Additional Information",description:"Share additional details about your issue",message:`Hi,

I would like to provide additional information for ticket #${(i=this.ticket)==null?void 0:i.uid}:

[Additional details here]

Please let me know if you need anything else.

Best regards`},{id:"urgent_request",title:"Urgent Request",description:"Mark your request as urgent",message:`Hi,

I need urgent assistance with ticket #${(b=this.ticket)==null?void 0:b.uid}.

[Describe the urgency and issue]

This is affecting my work/business and I would appreciate immediate attention.

Thank you for your prompt response.`}]}},computed:{canStartConversation(){return this.form.initial_message.trim().length>0&&!this.loading}},methods:{closeModal(){this.$emit("close"),this.resetForm()},resetForm(){this.form={conversation_type:"customer",initial_message:""},this.loading=!1},getInitials(t){return t?t.split(" ").map(s=>s.charAt(0)).join("").toUpperCase().substring(0,2):"U"},applyTemplate(t){this.form.initial_message=t.message},async startConversation(){var t,s;if(this.canStartConversation){this.loading=!0;try{const i={ticket_id:this.ticket.id,conversation_type:"customer",participants:this.getParticipants(),initial_message:this.form.initial_message,context:{ticket_uid:this.ticket.uid,ticket_subject:this.ticket.subject,ticket_status:(t=this.ticket.status)==null?void 0:t.name,initiated_by:"customer"}},b=(s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.getAttribute("content");if(!b)throw new Error("CSRF token not found");const n=await fetch("/conversations",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":b,"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(i)}),v=(n.headers.get("content-type")||"").includes("application/json");if(!n.ok)if(v){const _=await n.json();throw new Error(_.message||_.error||_.errors||`Server error: ${n.status}`)}else throw new Error(`Server error (${n.status}): ${n.statusText}`);if(!v)throw new Error("Invalid response format: expected JSON");const x=await n.json();if(x.success)console.log("Customer conversation created successfully:",x),this.$emit("conversation-created",x.data),this.closeModal();else throw new Error(x.message||"Failed to start conversation")}catch(i){console.error("Error starting customer conversation:",i);const b=i.message||"An unexpected error occurred while starting the conversation";this.$emit("conversation-error",b)}finally{this.loading=!1}}},getParticipants(){const t=[{user_id:this.user.id,role:"customer"}];return this.ticket.assigned_to&&t.push({user_id:this.ticket.assigned_to,role:"agent"}),t}}},Gi={key:0,class:"fixed inset-0 z-50 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},Wi={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},Qi={class:"inline-block align-bottom bg-white dark:bg-slate-800 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-2xl sm:w-full"},Ki={class:"bg-gradient-to-r from-green-600 to-emerald-600 px-6 py-4"},Zi={class:"flex items-center justify-between"},eo={class:"text-lg font-semibold text-white flex items-center gap-2"},to={class:"px-6 py-6"},so={class:"mb-6 p-4 bg-slate-50 dark:bg-slate-700 rounded-lg"},ao={class:"flex items-center gap-3"},io={class:"w-10 h-10 bg-gradient-to-br from-blue-500 to-blue-600 rounded-full flex items-center justify-center text-white text-sm font-semibold"},oo={class:"text-sm font-medium text-slate-900 dark:text-white"},ro={class:"text-xs text-slate-500 dark:text-slate-400"},no={class:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2"},lo={class:"p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg"},co={class:"flex items-center gap-3"},uo={class:"text-sm font-medium text-slate-900 dark:text-white"},mo={class:"text-xs text-slate-500 dark:text-slate-400"},ho={class:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2"},go={class:"space-y-2"},_o={class:"flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-700 rounded-lg"},xo={class:"flex items-center gap-3"},fo={class:"w-8 h-8 bg-gradient-to-br from-blue-500 to-blue-600 rounded-full flex items-center justify-center text-white text-sm font-semibold"},bo={class:"text-sm font-medium text-slate-900 dark:text-white"},vo={class:"text-xs text-slate-500 dark:text-slate-400"},ko={class:"flex items-center gap-2"},po={class:"text-xs text-slate-500 dark:text-slate-400"},yo={class:"flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-700 rounded-lg"},wo={class:"flex items-center gap-3"},Co={class:"w-8 h-8 bg-gradient-to-br from-green-500 to-green-600 rounded-full flex items-center justify-center text-white text-sm font-semibold"},$o={class:"text-sm font-medium text-slate-900 dark:text-white"},To={class:"text-xs text-slate-500 dark:text-slate-400"},So={class:"flex items-center gap-2"},Ao={class:"text-xs text-slate-500 dark:text-slate-400"},Mo={class:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2"},jo={class:"grid grid-cols-1 gap-3"},Io=["onClick"],Do={class:"text-sm font-medium text-slate-900 dark:text-white"},Po={class:"text-xs text-slate-500 dark:text-slate-400 mt-1"},No={class:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2"},Uo=["placeholder"],Lo={class:"mt-1 text-xs text-slate-500 dark:text-slate-400"},Eo={class:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg"},Fo={class:"flex items-start gap-3"},Ro={class:"w-5 h-5 text-blue-500 mt-0.5"},qo={class:"text-sm text-blue-800 dark:text-blue-200"},Yo={class:"font-medium mb-1"},Oo={class:"text-xs space-y-1"},Bo={class:"flex items-center justify-end gap-3 pt-4 border-t border-slate-200 dark:border-slate-600"},Vo=["disabled"],Ho={key:0,class:"flex items-center gap-2"},Jo={key:1,class:"flex items-center gap-2"};function Xo(t,s,i,b,n,o){const v=c("MessageCircle"),x=c("X"),_=c("Ticket"),h=c("CheckCircle"),f=c("Users"),k=c("Info"),C=c("Loader2");return i.show?(r(),l("div",Gi,[e("div",Wi,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true",onClick:s[0]||(s[0]=(...u)=>o.closeModal&&o.closeModal(...u))}),e("div",Qi,[e("div",Ki,[e("div",Zi,[e("h3",eo,[d(v,{class:"w-5 h-5"}),w(" "+a(t.$t("Start a Conversation")),1)]),e("button",{onClick:s[1]||(s[1]=(...u)=>o.closeModal&&o.closeModal(...u)),class:"text-white hover:text-gray-200 transition-colors"},[d(x,{class:"w-6 h-6"})])])]),e("div",to,[e("div",so,[e("div",ao,[e("div",io,[d(_,{class:"w-5 h-5"})]),e("div",null,[e("div",oo,"Ticket #"+a(i.ticket.uid),1),e("div",ro,a(i.ticket.subject),1)])])]),e("form",{onSubmit:s[4]||(s[4]=_e((...u)=>o.startConversation&&o.startConversation(...u),["prevent"])),class:"space-y-6"},[e("div",null,[e("label",no,a(t.$t("Conversation Type")),1),e("div",lo,[e("div",co,[s[5]||(s[5]=e("div",{class:"w-4 h-4 border-2 border-green-500 bg-green-500 rounded-full"},[e("div",{class:"w-2 h-2 bg-white rounded-full mx-auto mt-0.5"})],-1)),e("div",null,[e("div",uo,a(t.$t("Customer Support")),1),e("div",mo,a(t.$t("Direct communication with support team")),1)])])])]),e("div",null,[e("label",ho,a(t.$t("Who will be involved")),1),e("div",go,[e("div",_o,[e("div",xo,[e("div",fo,a(o.getInitials(i.user.name)),1),e("div",null,[e("div",bo,a(i.user.name),1),e("div",vo,a(t.$t("You")),1)])]),e("div",ko,[e("span",po,a(t.$t("Required")),1),d(h,{class:"w-4 h-4 text-green-500"})])]),e("div",yo,[e("div",wo,[e("div",Co,[d(f,{class:"w-4 h-4"})]),e("div",null,[e("div",$o,a(t.$t("Support Team")),1),e("div",To,a(t.$t("Available agents and specialists")),1)])]),e("div",So,[e("span",Ao,a(t.$t("Automatic")),1),d(h,{class:"w-4 h-4 text-green-500"})])])])]),e("div",null,[e("label",Mo,a(t.$t("Quick Start Options")),1),e("div",jo,[(r(!0),l(T,null,S(n.customerTemplates,u=>(r(),l("button",{key:u.id,type:"button",onClick:m=>o.applyTemplate(u),class:"p-3 text-left border border-slate-200 dark:border-slate-600 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors"},[e("div",Do,a(u.title),1),e("div",Po,a(u.description),1)],8,Io))),128))])]),e("div",null,[e("label",No,[w(a(t.$t("Your Message"))+" ",1),s[6]||(s[6]=e("span",{class:"text-red-500"},"*",-1))]),I(e("textarea",{"onUpdate:modelValue":s[2]||(s[2]=u=>n.form.initial_message=u),placeholder:t.$t("Describe your question or concern..."),rows:"4",class:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 dark:bg-slate-700 dark:text-white",required:""},null,8,Uo),[[ie,n.form.initial_message]]),e("div",Lo,a(n.form.initial_message.length)+"/1000 "+a(t.$t("characters")),1)]),e("div",Eo,[e("div",Fo,[e("div",Ro,[d(k,{class:"w-5 h-5"})]),e("div",qo,[e("div",Yo,a(t.$t("What happens next?")),1),e("ul",Oo,[e("li",null," "+a(t.$t("Your message will be sent to our support team")),1),e("li",null," "+a(t.$t("You will receive real-time responses")),1),e("li",null," "+a(t.$t("The conversation will be linked to this ticket")),1),e("li",null," "+a(t.$t("You can continue the conversation anytime")),1)])])])]),e("div",Bo,[e("button",{type:"button",onClick:s[3]||(s[3]=(...u)=>o.closeModal&&o.closeModal(...u)),class:"px-4 py-2 text-sm font-medium text-slate-700 dark:text-slate-300 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-600 transition-colors"},a(t.$t("Cancel")),1),e("button",{type:"submit",disabled:!o.canStartConversation,class:"px-4 py-2 text-sm font-medium text-white bg-green-600 rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},[n.loading?(r(),l("div",Ho,[d(C,{class:"w-4 h-4 animate-spin"}),w(" "+a(t.$t("Starting...")),1)])):(r(),l("div",Jo,[d(v,{class:"w-4 h-4"}),w(" "+a(t.$t("Start Conversation")),1)]))],8,Vo)])],32)])])])])):g("",!0)}const zo=j(zi,[["render",Xo]]),Go={name:"ConversationManager",components:{MessageCircle:M,RefreshCw:ne,Plus:be,Loader2:se,ChevronDown:Ve,ChevronUp:Be,ExternalLink:ve,Eye:ee},props:{ticketId:{type:[String,Number],required:!0},conversations:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},user:{type:Object,default:()=>({})}},computed:{filteredConversations(){var t;return(t=this.user)!=null&&t.id?this.conversations.filter(s=>{var n,o,v;const i=(n=s.participants)==null?void 0:n.some(x=>x.user_id===this.user.id),b=["admin","manager","agent"].includes((v=(o=this.user)==null?void 0:o.role)==null?void 0:v.slug);return i||b&&s.type==="internal"}):[]}},data(){return{moment:oe,refreshing:!1,expandedConversations:[]}},mounted(){},methods:{async refreshConversations(){this.refreshing=!0,this.$emit("refresh-conversations"),setTimeout(()=>{this.refreshing=!1},1e3)},startNewConversation(){this.$emit("start-new-conversation")},toggleConversation(t){const s=this.expandedConversations.indexOf(t);s>-1?this.expandedConversations.splice(s,1):this.expandedConversations.push(t)},joinConversation(t){this.$emit("join-conversation",t)},viewConversationDetails(t){this.$emit("view-conversation-details",t)},getConversationTypeClass(t){return t==="internal"?"bg-gradient-to-br from-slate-500 to-slate-600":"bg-gradient-to-br from-blue-500 to-blue-600"},getConversationTypeBadgeClass(t){return t==="internal"?"bg-slate-100 text-slate-800 dark:bg-slate-600 dark:text-slate-200":"bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-300"},getConversationTitle(t){var s;return(s=t.context)!=null&&s.ticket_uid?`${t.type==="internal"?"Internal":"Customer"} Discussion - #${t.context.ticket_uid}`:`${t.type==="internal"?"Internal":"Customer"} Discussion`},getInitials(t){return t?t.split(" ").map(s=>s.charAt(0)).join("").toUpperCase().substring(0,2):"U"},stripHtml(t){if(!t)return"";const s=document.createElement("div");return s.innerHTML=t,s.textContent||s.innerText||""}}},Wo={class:"conversation-manager"},Qo={class:"px-6 py-4 bg-gradient-to-r from-slate-50 to-slate-100/50 dark:from-slate-700/50 dark:to-slate-800/50 border-b border-slate-200 dark:border-slate-700"},Ko={class:"flex items-center justify-between"},Zo={class:"text-xl font-semibold text-slate-900 dark:text-white flex items-center gap-2"},er={key:0,class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-300"},tr={class:"flex items-center gap-2"},sr=["title"],ar={class:"p-6"},ir={key:0,class:"flex items-center justify-center py-8"},or={class:"ml-2 text-slate-600 dark:text-slate-400"},rr={key:1,class:"text-center py-8"},nr={class:"text-lg font-medium text-slate-900 dark:text-white mb-2"},lr={class:"text-slate-500 dark:text-slate-400 mb-4"},dr={key:2,class:"space-y-4"},cr=["data-conversation-id"],ur={class:"px-4 py-3 bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-600"},mr={class:"flex items-center justify-between"},hr={class:"flex items-center gap-3"},gr={class:"flex items-center gap-2"},_r={class:"text-sm font-medium text-slate-900 dark:text-white"},xr={class:"text-xs text-slate-500 dark:text-slate-400"},fr={key:0,class:"ml-2"},br={class:"flex items-center gap-2"},vr=["onClick"],kr=["onClick","title"],pr={key:0,class:"p-4 space-y-4"},yr={key:0},wr={class:"text-sm font-medium text-slate-900 dark:text-white mb-2"},Cr={class:"flex flex-wrap gap-2"},$r={class:"w-6 h-6 bg-gradient-to-br from-blue-500 to-blue-600 rounded-full flex items-center justify-center text-white text-xs font-semibold"},Tr={class:"text-sm text-slate-700 dark:text-slate-300"},Sr={class:"text-xs text-slate-500 dark:text-slate-400 capitalize"},Ar={key:1},Mr={class:"text-sm font-medium text-slate-900 dark:text-white mb-2"},jr={class:"space-y-2 max-h-40 overflow-y-auto"},Ir={class:"w-6 h-6 bg-gradient-to-br from-slate-500 to-slate-600 rounded-full flex items-center justify-center text-white text-xs font-semibold flex-shrink-0"},Dr={class:"flex-1 min-w-0"},Pr={class:"flex items-center gap-2 mb-1"},Nr={class:"text-xs font-medium text-slate-900 dark:text-white"},Ur={class:"text-xs text-slate-500 dark:text-slate-400"},Lr={class:"text-xs text-slate-600 dark:text-slate-400 line-clamp-2"},Er={key:2,class:"p-3 bg-slate-100 dark:bg-slate-600 rounded-lg"},Fr={class:"text-sm font-medium text-slate-900 dark:text-white mb-2"},Rr={class:"text-xs text-slate-600 dark:text-slate-400 space-y-1"},qr={key:0},Yr={class:"font-medium"},Or={key:1},Br={class:"font-medium"},Vr={key:2},Hr={class:"font-medium"},Jr={class:"flex items-center justify-between pt-3 border-t border-slate-200 dark:border-slate-600"},Xr={class:"flex items-center gap-2"},zr=["onClick"],Gr=["onClick"],Wr={class:"text-xs text-slate-500 dark:text-slate-400"};function Qr(t,s,i,b,n,o){const v=c("MessageCircle"),x=c("RefreshCw"),_=c("Plus"),h=c("Loader2"),f=c("ChevronDown"),k=c("ChevronUp"),C=c("ExternalLink"),u=c("Eye");return r(),l("div",Wo,[e("div",Qo,[e("div",Ko,[e("h2",Zo,[d(v,{class:"w-5 h-5"}),w(" "+a(t.$t("Conversations"))+" ",1),o.filteredConversations.length?(r(),l("span",er,a(o.filteredConversations.length),1)):g("",!0)]),e("div",tr,[e("button",{onClick:s[0]||(s[0]=(...m)=>o.refreshConversations&&o.refreshConversations(...m)),class:"p-1 text-slate-400 hover:text-slate-600 dark:hover:text-slate-300 transition-colors",title:t.$t("Refresh")},[d(x,{class:p(["w-4 h-4",{"animate-spin":n.refreshing}])},null,8,["class"])],8,sr),e("button",{onClick:s[1]||(s[1]=(...m)=>o.startNewConversation&&o.startNewConversation(...m)),class:"inline-flex items-center gap-2 px-3 py-1.5 text-sm font-medium text-white bg-green-600 rounded-lg hover:bg-green-700 transition-colors"},[d(_,{class:"w-4 h-4"}),w(" "+a(t.$t("New Conversation")),1)])])])]),e("div",ar,[i.loading?(r(),l("div",ir,[d(h,{class:"w-6 h-6 animate-spin text-blue-600"}),e("span",or,a(t.$t("Loading conversations...")),1)])):o.filteredConversations.length===0?(r(),l("div",rr,[d(v,{class:"w-12 h-12 mx-auto mb-4 text-slate-300 dark:text-slate-600"}),e("h3",nr,a(t.$t("No conversations yet")),1),e("p",lr,a(t.$t("Start a conversation to discuss this ticket")),1),e("button",{onClick:s[2]||(s[2]=(...m)=>o.startNewConversation&&o.startNewConversation(...m)),class:"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors"},[d(_,{class:"w-4 h-4"}),w(" "+a(t.$t("Start First Conversation")),1)])])):(r(),l("div",dr,[(r(!0),l(T,null,S(o.filteredConversations,m=>{var D,N,V;return r(),l("div",{key:m.id,"data-conversation-id":m.id,class:"bg-slate-50 dark:bg-slate-700/50 rounded-lg border border-slate-200 dark:border-slate-600 overflow-hidden"},[e("div",ur,[e("div",mr,[e("div",hr,[e("div",{class:p(["w-8 h-8 rounded-full flex items-center justify-center text-white text-sm font-semibold",o.getConversationTypeClass(m.type)])},[d(v,{class:"w-4 h-4"})],2),e("div",null,[e("div",gr,[e("h4",_r,a(o.getConversationTitle(m)),1),e("span",{class:p(["inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium",o.getConversationTypeBadgeClass(m.type)])},a(m.type==="internal"?t.$t("Internal"):t.$t("Customer")),3)]),e("div",xr,[w(a(t.$t("Created"))+" "+a(n.moment(m.created_at).fromNow())+" ",1),(D=m.participants)!=null&&D.length?(r(),l("span",fr,"  "+a(m.participants.length)+" "+a(t.$t("participants")),1)):g("",!0)])])]),e("div",br,[e("button",{onClick:$=>o.toggleConversation(m.id),class:"p-1 text-slate-400 hover:text-slate-600 dark:hover:text-slate-300 transition-colors"},[n.expandedConversations.includes(m.id)?(r(),A(k,{key:1,class:"w-4 h-4"})):(r(),A(f,{key:0,class:"w-4 h-4"}))],8,vr),e("button",{onClick:$=>o.joinConversation(m),class:"p-1 text-slate-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors",title:t.$t("Join Conversation")},[d(C,{class:"w-4 h-4"})],8,kr)])])]),n.expandedConversations.includes(m.id)?(r(),l("div",pr,[(N=m.participants)!=null&&N.length?(r(),l("div",yr,[e("h5",wr,a(t.$t("Participants")),1),e("div",Cr,[(r(!0),l(T,null,S(m.participants,$=>{var U,L,E,F;return r(),l("div",{key:$.id,class:"flex items-center gap-2 px-3 py-1.5 bg-white dark:bg-slate-700 rounded-lg border border-slate-200 dark:border-slate-600"},[e("div",$r,a(o.getInitials(((U=$.user)==null?void 0:U.name)||((L=$.user)==null?void 0:L.first_name))),1),e("span",Tr,a(((E=$.user)==null?void 0:E.name)||((F=$.user)==null?void 0:F.first_name)),1),e("span",Sr,a($.role),1)])}),128))])])):g("",!0),(V=m.messages)!=null&&V.length?(r(),l("div",Ar,[e("h5",Mr,a(t.$t("Recent Messages")),1),e("div",jr,[(r(!0),l(T,null,S(m.messages.slice(-3),$=>{var U,L,E,F;return r(),l("div",{key:$.id,class:"flex gap-2 p-2 bg-white dark:bg-slate-700 rounded border border-slate-200 dark:border-slate-600"},[e("div",Ir,a(o.getInitials(((U=$.user)==null?void 0:U.name)||((L=$.user)==null?void 0:L.first_name))),1),e("div",Dr,[e("div",Pr,[e("span",Nr,a(((E=$.user)==null?void 0:E.name)||((F=$.user)==null?void 0:F.first_name)),1),e("span",Ur,a(n.moment($.created_at).format("MMM D, h:mm A")),1)]),e("p",Lr,a(o.stripHtml($.message)),1)])])}),128))])])):g("",!0),m.context?(r(),l("div",Er,[e("h5",Fr,a(t.$t("Context")),1),e("div",Rr,[m.context.ticket_uid?(r(),l("div",qr,[e("span",Yr,a(t.$t("Ticket"))+":",1),w(" #"+a(m.context.ticket_uid),1)])):g("",!0),m.context.ticket_subject?(r(),l("div",Or,[e("span",Br,a(t.$t("Subject"))+":",1),w(" "+a(m.context.ticket_subject),1)])):g("",!0),m.context.ticket_status?(r(),l("div",Vr,[e("span",Hr,a(t.$t("Status"))+":",1),w(" "+a(m.context.ticket_status),1)])):g("",!0)])])):g("",!0),e("div",Jr,[e("div",Xr,[e("button",{onClick:$=>o.joinConversation(m),class:"inline-flex items-center gap-1 px-3 py-1.5 text-xs font-medium text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20 rounded-lg hover:bg-blue-100 dark:hover:bg-blue-900/30 transition-colors"},[d(C,{class:"w-3 h-3"}),w(" "+a(t.$t("Join")),1)],8,zr),e("button",{onClick:$=>o.viewConversationDetails(m),class:"inline-flex items-center gap-1 px-3 py-1.5 text-xs font-medium text-slate-600 dark:text-slate-400 bg-slate-100 dark:bg-slate-600 rounded-lg hover:bg-slate-200 dark:hover:bg-slate-500 transition-colors"},[d(u,{class:"w-3 h-3"}),w(" "+a(t.$t("Details")),1)],8,Gr)]),e("div",Wr,a(t.$t("Last activity"))+" "+a(n.moment(m.updated_at).fromNow()),1)])])):g("",!0)],8,cr)}),128))]))])])}const Kr=j(Go,[["render",Qr],["__scopeId","data-v-1485b57c"]]),Zr={name:"ConversationAnalytics",components:{BarChart3:He,RefreshCw:ne,Loader2:se,MessageCircle:M,Users:Q,Clock:Z,TrendingUp:ke},props:{ticketId:{type:[String,Number],required:!0},conversations:{type:Array,default:()=>[]}},data(){return{loading:!1,refreshing:!1,timeRange:"30d",analytics:{totalConversations:0,activeParticipants:0,avgResponseTime:0,messagesPerDay:0,conversationTypes:[],activityTimeline:[],topParticipants:[],maxActivity:0,maxMessages:0}}},watch:{conversations:{handler(){this.calculateAnalytics()},immediate:!0},timeRange(){this.calculateAnalytics()}},methods:{calculateAnalytics(){this.loading=!0,setTimeout(()=>{this.analytics=this.generateAnalytics(),this.loading=!1},500)},generateAnalytics(){const t=this.conversations||[],s=t.length,i=new Set;let b=0;t.forEach(f=>{f.participants&&f.participants.forEach(k=>{var C;return i.add(((C=k.user)==null?void 0:C.id)||k.user_id)}),f.messages&&(b+=f.messages.length)});const n=[{name:"internal",label:"Internal",count:t.filter(f=>f.type==="internal").length,color:"bg-slate-500"},{name:"customer",label:"Customer",count:t.filter(f=>f.type==="customer").length,color:"bg-blue-500"}];n.forEach(f=>{f.percentage=s>0?f.count/s*100:0});const o=[],v=Math.max(...Array.from({length:7},(f,k)=>{const C=new Date;return C.setDate(C.getDate()-k),t.filter(m=>new Date(m.created_at).toDateString()===C.toDateString()).length}));for(let f=6;f>=0;f--){const k=new Date;k.setDate(k.getDate()-f);const C=t.filter(u=>new Date(u.created_at).toDateString()===k.toDateString());o.push({date:k.toISOString().split("T")[0],count:C.length})}const x={};t.forEach(f=>{f.participants&&f.participants.forEach(k=>{var u,m,D,N;const C=((u=k.user)==null?void 0:u.id)||k.user_id;x[C]||(x[C]={id:C,name:((m=k.user)==null?void 0:m.name)||`${(D=k.user)==null?void 0:D.first_name} ${(N=k.user)==null?void 0:N.last_name}`,role:k.role,messageCount:0})}),f.messages&&f.messages.forEach(k=>{var u;const C=((u=k.user)==null?void 0:u.id)||k.user_id;x[C]&&x[C].messageCount++})});const _=Object.values(x).sort((f,k)=>k.messageCount-f.messageCount).slice(0,5),h=Math.max(..._.map(f=>f.messageCount),1);return{totalConversations:s,activeParticipants:i.size,avgResponseTime:0,messagesPerDay:Math.round(b/7),conversationTypes:n,activityTimeline:o,topParticipants:_,maxActivity:Math.max(v,1),maxMessages:h}},refreshAnalytics(){this.refreshing=!0,this.calculateAnalytics(),setTimeout(()=>{this.refreshing=!1},1e3)},formatDuration(t){return t<60?`${Math.round(t)}m`:t<1440?`${Math.round(t/60)}h`:`${Math.round(t/1440)}d`},formatDate(t){return new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric"})},getInitials(t){return t?t.split(" ").map(s=>s.charAt(0)).join("").toUpperCase().substring(0,2):"U"}}},en={class:"conversation-analytics"},tn={class:"px-6 py-4 bg-gradient-to-r from-slate-50 to-slate-100/50 dark:from-slate-700/50 dark:to-slate-800/50 border-b border-slate-200 dark:border-slate-700"},sn={class:"flex items-center justify-between"},an={class:"text-xl font-semibold text-slate-900 dark:text-white flex items-center gap-2"},on={class:"flex items-center gap-2"},rn={value:"7d"},nn={value:"30d"},ln={value:"90d"},dn={class:"p-6"},cn={key:0,class:"flex items-center justify-center py-8"},un={class:"ml-2 text-slate-600 dark:text-slate-400"},mn={key:1,class:"space-y-6"},hn={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},gn={class:"bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-600 p-4"},_n={class:"flex items-center"},xn={class:"flex-shrink-0"},fn={class:"w-8 h-8 bg-blue-100 dark:bg-blue-900/20 rounded-lg flex items-center justify-center"},bn={class:"ml-3"},vn={class:"text-sm font-medium text-slate-500 dark:text-slate-400"},kn={class:"text-2xl font-semibold text-slate-900 dark:text-white"},pn={class:"bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-600 p-4"},yn={class:"flex items-center"},wn={class:"flex-shrink-0"},Cn={class:"w-8 h-8 bg-green-100 dark:bg-green-900/20 rounded-lg flex items-center justify-center"},$n={class:"ml-3"},Tn={class:"text-sm font-medium text-slate-500 dark:text-slate-400"},Sn={class:"text-2xl font-semibold text-slate-900 dark:text-white"},An={class:"bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-600 p-4"},Mn={class:"flex items-center"},jn={class:"flex-shrink-0"},In={class:"w-8 h-8 bg-purple-100 dark:bg-purple-900/20 rounded-lg flex items-center justify-center"},Dn={class:"ml-3"},Pn={class:"text-sm font-medium text-slate-500 dark:text-slate-400"},Nn={class:"text-2xl font-semibold text-slate-900 dark:text-white"},Un={class:"bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-600 p-4"},Ln={class:"flex items-center"},En={class:"flex-shrink-0"},Fn={class:"w-8 h-8 bg-orange-100 dark:bg-orange-900/20 rounded-lg flex items-center justify-center"},Rn={class:"ml-3"},qn={class:"text-sm font-medium text-slate-500 dark:text-slate-400"},Yn={class:"text-2xl font-semibold text-slate-900 dark:text-white"},On={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},Bn={class:"bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-600 p-6"},Vn={class:"text-lg font-medium text-slate-900 dark:text-white mb-4"},Hn={class:"space-y-3"},Jn={class:"flex items-center gap-3"},Xn={class:"text-sm text-slate-700 dark:text-slate-300"},zn={class:"flex items-center gap-2"},Gn={class:"w-24 bg-slate-200 dark:bg-slate-700 rounded-full h-2"},Wn={class:"text-sm font-medium text-slate-900 dark:text-white w-8 text-right"},Qn={class:"bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-600 p-6"},Kn={class:"text-lg font-medium text-slate-900 dark:text-white mb-4"},Zn={class:"space-y-3"},el={class:"text-sm text-slate-700 dark:text-slate-300"},tl={class:"flex items-center gap-2"},sl={class:"w-32 bg-slate-200 dark:bg-slate-700 rounded-full h-2"},al={class:"text-sm font-medium text-slate-900 dark:text-white w-8 text-right"},il={class:"bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-600 p-6"},ol={class:"text-lg font-medium text-slate-900 dark:text-white mb-4"},rl={class:"space-y-3"},nl={class:"w-8 h-8 bg-gradient-to-br from-blue-500 to-blue-600 rounded-full flex items-center justify-center text-white text-sm font-semibold"},ll={class:"flex-1 min-w-0"},dl={class:"text-sm font-medium text-slate-900 dark:text-white truncate"},cl={class:"text-xs text-slate-500 dark:text-slate-400"},ul={class:"flex items-center gap-2"},ml={class:"w-24 bg-slate-200 dark:bg-slate-700 rounded-full h-2"},hl={class:"text-sm font-medium text-slate-900 dark:text-white w-8 text-right"};function gl(t,s,i,b,n,o){const v=c("BarChart3"),x=c("RefreshCw"),_=c("Loader2"),h=c("MessageCircle"),f=c("Users"),k=c("Clock"),C=c("TrendingUp");return r(),l("div",en,[e("div",tn,[e("div",sn,[e("h2",an,[d(v,{class:"w-5 h-5"}),w(" "+a(t.$t("Conversation Analytics")),1)]),e("div",on,[I(e("select",{"onUpdate:modelValue":s[0]||(s[0]=u=>n.timeRange=u),class:"text-sm border border-slate-300 dark:border-slate-600 rounded-lg px-3 py-1 dark:bg-slate-700 dark:text-white"},[e("option",rn,a(t.$t("Last 7 days")),1),e("option",nn,a(t.$t("Last 30 days")),1),e("option",ln,a(t.$t("Last 90 days")),1)],512),[[Ne,n.timeRange]]),e("button",{onClick:s[1]||(s[1]=(...u)=>o.refreshAnalytics&&o.refreshAnalytics(...u)),class:"p-1 text-slate-400 hover:text-slate-600 dark:hover:text-slate-300 transition-colors"},[d(x,{class:p(["w-4 h-4",{"animate-spin":n.refreshing}])},null,8,["class"])])])])]),e("div",dn,[n.loading?(r(),l("div",cn,[d(_,{class:"w-6 h-6 animate-spin text-blue-600"}),e("span",un,a(t.$t("Loading analytics...")),1)])):(r(),l("div",mn,[e("div",hn,[e("div",gn,[e("div",_n,[e("div",xn,[e("div",fn,[d(h,{class:"w-5 h-5 text-blue-600 dark:text-blue-400"})])]),e("div",bn,[e("p",vn,a(t.$t("Total Conversations")),1),e("p",kn,a(n.analytics.totalConversations),1)])])]),e("div",pn,[e("div",yn,[e("div",wn,[e("div",Cn,[d(f,{class:"w-5 h-5 text-green-600 dark:text-green-400"})])]),e("div",$n,[e("p",Tn,a(t.$t("Active Participants")),1),e("p",Sn,a(n.analytics.activeParticipants),1)])])]),e("div",An,[e("div",Mn,[e("div",jn,[e("div",In,[d(k,{class:"w-5 h-5 text-purple-600 dark:text-purple-400"})])]),e("div",Dn,[e("p",Pn,a(t.$t("Avg Response Time")),1),e("p",Nn,a(o.formatDuration(n.analytics.avgResponseTime)),1)])])]),e("div",Un,[e("div",Ln,[e("div",En,[e("div",Fn,[d(C,{class:"w-5 h-5 text-orange-600 dark:text-orange-400"})])]),e("div",Rn,[e("p",qn,a(t.$t("Messages per Day")),1),e("p",Yn,a(n.analytics.messagesPerDay),1)])])])]),e("div",On,[e("div",Bn,[e("h3",Vn,a(t.$t("Conversation Types")),1),e("div",Hn,[(r(!0),l(T,null,S(n.analytics.conversationTypes,u=>(r(),l("div",{key:u.name,class:"flex items-center justify-between"},[e("div",Jn,[e("div",{class:p(["w-3 h-3 rounded-full",u.color])},null,2),e("span",Xn,a(u.label),1)]),e("div",zn,[e("div",Gn,[e("div",{class:p(["h-2 rounded-full",u.color]),style:J({width:`${u.percentage}%`})},null,6)]),e("span",Wn,a(u.count),1)])]))),128))])]),e("div",Qn,[e("h3",Kn,a(t.$t("Activity Timeline")),1),e("div",Zn,[(r(!0),l(T,null,S(n.analytics.activityTimeline,u=>(r(),l("div",{key:u.date,class:"flex items-center justify-between"},[e("span",el,a(o.formatDate(u.date)),1),e("div",tl,[e("div",sl,[e("div",{class:"h-2 bg-blue-500 rounded-full",style:J({width:`${u.count/n.analytics.maxActivity*100}%`})},null,4)]),e("span",al,a(u.count),1)])]))),128))])])]),e("div",il,[e("h3",ol,a(t.$t("Top Participants")),1),e("div",rl,[(r(!0),l(T,null,S(n.analytics.topParticipants,u=>(r(),l("div",{key:u.id,class:"flex items-center gap-3"},[e("div",nl,a(o.getInitials(u.name)),1),e("div",ll,[e("div",dl,a(u.name),1),e("div",cl,a(u.role),1)]),e("div",ul,[e("div",ml,[e("div",{class:"h-2 bg-green-500 rounded-full",style:J({width:`${u.messageCount/n.analytics.maxMessages*100}%`})},null,4)]),e("span",hl,a(u.messageCount),1)])]))),128))])])]))])])}const _l=j(Zr,[["render",gl],["__scopeId","data-v-2d1b269c"]]),xl={name:"NotificationToast",components:{CheckCircle:P,XCircle:ge,AlertTriangle:q,Info:X,X:te,ExternalLink:ve,MessageCircle:M},props:{notification:{type:Object,required:!0},show:{type:Boolean,default:!1}},data(){return{progress:100,interval:null}},mounted(){this.notification.duration&&this.startProgress()},beforeUnmount(){this.interval&&clearInterval(this.interval)},methods:{startProgress(){const t=this.notification.duration||5e3,s=50,i=s/t*100;this.interval=setInterval(()=>{this.progress-=i,this.progress<=0&&this.close()},s)},close(){this.$emit("close")},handleAction(t){this.$emit("action",t),t.closeOnClick!==!1&&this.close()},getIcon(t){return{success:P,error:ge,warning:q,info:X,conversation:M}[t]||X},getIconClass(t){return{success:"bg-green-500",error:"bg-red-500",warning:"bg-yellow-500",info:"bg-blue-500",conversation:"bg-purple-500"}[t]||"bg-blue-500"},getActionClass(t){const s={primary:"text-blue-600 hover:text-blue-500 dark:text-blue-400 dark:hover:text-blue-300",secondary:"text-slate-600 hover:text-slate-500 dark:text-slate-400 dark:hover:text-slate-300",danger:"text-red-600 hover:text-red-500 dark:text-red-400 dark:hover:text-red-300"};return s[t]||s.secondary},getProgressBarClass(t){return{success:"bg-green-500",error:"bg-red-500",warning:"bg-yellow-500",info:"bg-blue-500",conversation:"bg-purple-500"}[t]||"bg-blue-500"}}},fl={key:0,class:"max-w-sm w-full bg-white dark:bg-slate-800 shadow-lg rounded-lg pointer-events-auto ring-1 ring-black ring-opacity-5 overflow-hidden"},bl={class:"p-4"},vl={class:"flex items-start"},kl={class:"flex-shrink-0"},pl={class:"ml-3 w-0 flex-1 pt-0.5"},yl={class:"text-sm font-medium text-slate-900 dark:text-white"},wl={class:"mt-1 text-sm text-slate-500 dark:text-slate-400"},Cl={key:0,class:"mt-3 flex space-x-2"},$l=["onClick"],Tl={class:"ml-4 flex-shrink-0 flex"},Sl={class:"sr-only"},Al={key:0,class:"h-1 bg-slate-200 dark:bg-slate-700"};function Ml(t,s,i,b,n,o){const v=c("X");return r(),A(Ue,{"enter-active-class":"transform ease-out duration-300 transition","enter-from-class":"translate-y-2 opacity-0 sm:translate-y-0 sm:translate-x-2","enter-to-class":"translate-y-0 opacity-100 sm:translate-x-0","leave-active-class":"transition ease-in duration-100","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:z(()=>{var x;return[i.show?(r(),l("div",fl,[e("div",bl,[e("div",vl,[e("div",kl,[e("div",{class:p(["w-8 h-8 rounded-full flex items-center justify-center",o.getIconClass(i.notification.type)])},[(r(),A(K(o.getIcon(i.notification.type)),{class:"w-5 h-5 text-white"}))],2)]),e("div",pl,[e("p",yl,a(i.notification.title),1),e("p",wl,a(i.notification.message),1),(x=i.notification.actions)!=null&&x.length?(r(),l("div",Cl,[(r(!0),l(T,null,S(i.notification.actions,_=>(r(),l("button",{key:_.label,onClick:h=>o.handleAction(_),class:p(["text-sm font-medium",o.getActionClass(_.type)])},a(_.label),11,$l))),128))])):g("",!0)]),e("div",Tl,[e("button",{onClick:s[0]||(s[0]=(..._)=>o.close&&o.close(..._)),class:"bg-white dark:bg-slate-800 rounded-md inline-flex text-slate-400 hover:text-slate-500 dark:hover:text-slate-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},[e("span",Sl,a(t.$t("Close")),1),d(v,{class:"h-5 w-5"})])])])]),i.notification.duration?(r(),l("div",Al,[e("div",{class:p(["h-1 transition-all duration-100 ease-linear",o.getProgressBarClass(i.notification.type)]),style:J({width:`${n.progress}%`})},null,6)])):g("",!0)])):g("",!0)]}),_:1})}const jl=j(xl,[["render",Ml],["__scopeId","data-v-39ea8591"]]),Il={name:"NotificationManager",components:{NotificationToast:jl},data(){return{notifications:[],nextId:1}},methods:{addNotification(t){const s=this.nextId++,i={id:s,type:"info",title:"Notification",message:"",duration:5e3,actions:[],...t};return this.notifications.push(i),i.duration&&setTimeout(()=>{this.removeNotification(s)},i.duration),s},removeNotification(t){const s=this.notifications.findIndex(i=>i.id===t);s>-1&&this.notifications.splice(s,1)},clearAll(){this.notifications=[]},handleNotificationAction(t){t.handler&&t.handler(t)},success(t,s,i={}){return this.addNotification({type:"success",title:t,message:s,...i})},error(t,s,i={}){return this.addNotification({type:"error",title:t,message:s,duration:0,...i})},warning(t,s,i={}){return this.addNotification({type:"warning",title:t,message:s,...i})},info(t,s,i={}){return this.addNotification({type:"info",title:t,message:s,...i})},conversation(t,s,i={}){return this.addNotification({type:"conversation",title:t,message:s,...i})}}},Dl={class:"notification-manager"},Pl={"aria-live":"assertive",class:"fixed inset-0 flex items-end px-4 py-6 pointer-events-none sm:p-6 sm:items-start z-50"},Nl={class:"w-full flex flex-col items-center space-y-4 sm:items-end"};function Ul(t,s,i,b,n,o){const v=c("NotificationToast");return r(),l("div",Dl,[e("div",Pl,[e("div",Nl,[d(Le,{"enter-active-class":"transform ease-out duration-300 transition","enter-from-class":"translate-y-2 opacity-0 sm:translate-y-0 sm:translate-x-2","enter-to-class":"translate-y-0 opacity-100 sm:translate-x-0","leave-active-class":"transition ease-in duration-100","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:z(()=>[(r(!0),l(T,null,S(n.notifications,x=>(r(),A(v,{key:x.id,notification:x,show:!0,onClose:_=>o.removeNotification(x.id),onAction:o.handleNotificationAction},null,8,["notification","onClose","onAction"]))),128))]),_:1})])])])}const Ll=j(Il,[["render",Ul],["__scopeId","data-v-82cd0d3f"]]),El={components:{Link:Fe,Head:Ee,TicketTimeline:ha,ConversationStarter:Xi,CustomerConversationStarter:zo,ConversationManager:Kr,ConversationAnalytics:_l,NotificationManager:Ll,Ticket:le,Edit:Y,Printer:tt,Download:fe,File:re,MessageCircle:M,AlertTriangle:q,Clock:Z,AlertCircle:et,CheckCircle:P,Copy:Ze,Star:G,Share2:Ke,ChevronRight:Qe,Calendar:We,Globe:Ge,TrendingUp:ke,Zap:ze,Tag:W,Eye:ee,EyeOff:Xe,FileText:Je,Paperclip:B},layout:Re,props:{title:String,ticket:Object,attachments:Array,comments:Array,entries:Array,activities:Array,availableUsers:{type:Array,default:()=>[]},user:{type:Object,default:()=>({})},conversations:{type:Array,default:()=>[]}},data(){return{moment:oe,showDescription:!0,isFavorited:!1,showConversationStarter:!1,showCustomerConversationStarter:!1,conversationsLoading:!1,conversationPollingInterval:null,localConversations:[]}},computed:{isAdmin(){var t,s,i,b,n,o;return((s=(t=this.user)==null?void 0:t.role)==null?void 0:s.slug)==="admin"||((b=(i=this.user)==null?void 0:i.role)==null?void 0:b.slug)==="manager"||((o=(n=this.user)==null?void 0:n.role)==null?void 0:o.slug)==="agent"},isCustomer(){var t,s;return((s=(t=this.user)==null?void 0:t.role)==null?void 0:s.slug)==="customer"},displayConversations(){return this.localConversations.length>0?this.localConversations:this.conversations},canEditTicket(){var s,i,b,n,o,v,x;let t=null;try{t=(i=(s=this.user)==null?void 0:s.role)!=null&&i.access?JSON.parse(this.user.role.access):null}catch{return!1}return!(!((b=t==null?void 0:t.ticket)!=null&&b.update)||((o=(n=this.user)==null?void 0:n.role)==null?void 0:o.slug)==="customer"&&((v=this.ticket)==null?void 0:v.user_id)!==((x=this.user)==null?void 0:x.id))}},mounted(){this.localConversations=[...this.conversations],this.setupConversationUpdates()},beforeUnmount(){this.cleanupConversationUpdates()},methods:{getFileSize(t){const s=Math.floor(Math.log(t)/Math.log(1024));return(t/Math.pow(1024,s)).toFixed(2)*1+" "+["B","KB","MB","GB","TB"][s]},downloadAttachment(t){const s=document.createElement("a");s.href=window.location.origin+"/files/"+t.path,s.download=t.name,s.click()},printTicket(){window.print()},copyTicketId(){navigator.clipboard.writeText(`#${this.ticket.uid}`)},copyDescription(){const t=document.createElement("div");t.innerHTML=this.ticket.details,navigator.clipboard.writeText(t.textContent||t.innerText||"")},toggleDescription(){this.showDescription=!this.showDescription},toggleFavorite(){this.isFavorited=!this.isFavorited},shareTicket(){navigator.share?navigator.share({title:`Ticket #${this.ticket.uid}`,text:this.ticket.subject,url:window.location.href}):navigator.clipboard.writeText(window.location.href)},startConversation(){this.showConversationStarter=!0},startCustomerConversation(){this.showCustomerConversationStarter=!0},handleConversationCreated(t){console.log("Conversation created response:",t),console.log("Current conversations before update:",this.localConversations.length);const s=t.conversation,i=t.initial_message;if(s&&s.id){const b={id:s.id,type:s.type||"internal",title:`Conversation #${s.id}`,created_at:s.created_at||new Date().toISOString(),updated_at:s.updated_at||new Date().toISOString(),ticket_id:s.ticket_id,participants:s.participants||[],messages:i?[i]:[],ticket:{id:this.ticket.id,uid:this.ticket.uid,subject:this.ticket.subject}};this.localConversations.unshift(b),console.log("Conversation added to list. New count:",this.localConversations.length),this.$nextTick(()=>{const n=document.querySelector(`[data-conversation-id="${b.id}"]`);n&&(n.classList.add("animate-pulse","bg-green-50","dark:bg-green-900/20"),setTimeout(()=>{n.classList.remove("animate-pulse","bg-green-50","dark:bg-green-900/20")},3e3))}),this.$refs.notificationManager&&this.$refs.notificationManager.success("Conversation Started","New conversation has been created successfully!",{duration:3e3}),console.log("Conversation added to list:",b)}else console.warn("Invalid conversation data received:",t)},handleConversationError(t){console.log(t),console.error("Conversation creation error:",t),this.$refs.notificationManager&&this.$refs.notificationManager.error("Error","Failed to start conversation: "+t,{duration:5e3})},async refreshConversations(){this.conversationsLoading=!0;try{const t=await fetch(`/tickets/${this.ticket.id}/conversations`,{method:"GET",headers:{Accept:"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}});if(t.ok){const s=await t.json();s.success&&s.data&&(this.localConversations=s.data,console.log("Conversations refreshed from server:",s.data.length))}else console.warn("Failed to refresh conversations:",t.status)}catch(t){console.error("Error refreshing conversations:",t)}finally{this.conversationsLoading=!1}},joinConversation(t){this.$inertia.visit(route("conversations.view",t.id))},viewConversationDetails(t){this.$inertia.visit(route("conversations.view",t.id))},setupConversationUpdates(){this.conversationPollingInterval=setInterval(()=>{this.checkForNewConversations()},3e4),window.Echo&&this.setupWebSocketListeners()},cleanupConversationUpdates(){this.conversationPollingInterval&&(clearInterval(this.conversationPollingInterval),this.conversationPollingInterval=null),window.Echo&&window.Echo.leave(`ticket.${this.ticket.id}`)},async checkForNewConversations(){try{if(this.conversationsLoading)return;const t=await fetch(`/tickets/${this.ticket.id}/conversations`,{method:"GET",headers:{Accept:"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}});if(t.ok){const s=await t.json();if(s.success&&s.data){const i=this.localConversations.map(n=>n.id).sort(),b=s.data.map(n=>n.id).sort();JSON.stringify(i)!==JSON.stringify(b)&&(this.localConversations=s.data,console.log("Conversations updated via polling"))}}}catch(t){console.warn("Error checking for new conversations:",t)}},setupWebSocketListeners(){window.Echo.private(`ticket.${this.ticket.id}`).listen("ConversationCreated",t=>{console.log("New conversation created via WebSocket:",t),this.handleConversationCreated(t.conversation)}).listen("ConversationUpdated",t=>{console.log("Conversation updated via WebSocket:",t),this.refreshConversations()})},getStatusClass(t){var i;if(!t)return"bg-slate-100 text-slate-800 dark:bg-slate-700 dark:text-slate-300";const s=((i=t.name)==null?void 0:i.toLowerCase())||t.toLowerCase();return s.includes("open")||s.includes("new")?"bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-300":s.includes("pending")||s.includes("waiting")?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-300":s.includes("closed")||s.includes("resolved")?"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-300":s.includes("cancelled")||s.includes("cancelled")?"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-300":"bg-slate-100 text-slate-800 dark:bg-slate-700 dark:text-slate-300"},getPriorityClass(t){if(!t)return"bg-slate-100 text-slate-800 dark:bg-slate-700 dark:text-slate-300";const s=t.toLowerCase();return s.includes("high")||s.includes("urgent")?"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-300":s.includes("medium")||s.includes("normal")?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-300":s.includes("low")?"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-300":"bg-slate-100 text-slate-800 dark:bg-slate-700 dark:text-slate-300"},getImpactClass(t){return{critical:"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-300",high:"bg-orange-100 text-orange-800 dark:bg-orange-900/20 dark:text-orange-300",medium:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-300",low:"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-300"}[t]||"bg-slate-100 text-slate-800 dark:bg-slate-700 dark:text-slate-300"},getUrgencyClass(t){return{critical:"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-300",high:"bg-orange-100 text-orange-800 dark:bg-orange-900/20 dark:text-orange-300",medium:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-300",low:"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-300"}[t]||"bg-slate-100 text-slate-800 dark:bg-slate-700 dark:text-slate-300"},getStatusDotClass(t){var i;if(!t)return"bg-slate-400";const s=((i=t.name)==null?void 0:i.toLowerCase())||t.toLowerCase();return s.includes("open")||s.includes("new")?"bg-blue-500":s.includes("pending")||s.includes("waiting")?"bg-yellow-500":s.includes("closed")||s.includes("resolved")?"bg-green-500":s.includes("cancelled")||s.includes("cancelled")?"bg-red-500":"bg-slate-400"},getPriorityDotClass(t){if(!t)return"bg-slate-400";const s=t.toLowerCase();return s.includes("high")||s.includes("urgent")?"bg-red-500":s.includes("medium")||s.includes("normal")?"bg-yellow-500":s.includes("low")?"bg-green-500":"bg-slate-400"}}},Fl={class:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50/30 to-indigo-50/20 dark:from-slate-900 dark:via-slate-800 dark:to-slate-900",role:"main","aria-label":"Ticket Details"},Rl={class:"relative overflow-hidden"},ql={class:"relative bg-white/60 dark:bg-slate-800/60 backdrop-blur-sm border-b border-slate-200/30 dark:border-slate-700/30"},Yl={class:"px-6 py-3"},Ol={class:"flex items-center space-x-2 text-sm"},Bl={class:"text-slate-900 dark:text-white font-medium"},Vl={class:"relative bg-white/80 dark:bg-slate-800/80 backdrop-blur-xl border-b border-slate-200/50 dark:border-slate-700/50"},Hl={class:"px-6 py-6"},Jl={class:"flex flex-col lg:flex-row lg:items-start lg:justify-between gap-6"},Xl={class:"flex-1"},zl={class:"flex items-start gap-4 mb-4"},Gl={class:"relative"},Wl={class:"w-14 h-14 bg-gradient-to-br from-blue-500 via-blue-600 to-indigo-600 rounded-2xl flex items-center justify-center shadow-lg shadow-blue-500/25"},Ql={key:0,class:"absolute -top-2 -right-2 w-7 h-7 bg-red-500 rounded-full flex items-center justify-center shadow-lg animate-pulse"},Kl={key:1,class:"absolute -top-2 -right-2 w-7 h-7 bg-orange-500 rounded-full flex items-center justify-center shadow-lg"},Zl={key:2,class:"absolute -top-2 -right-2 w-7 h-7 bg-yellow-500 rounded-full flex items-center justify-center shadow-lg"},ed={key:3,class:"absolute -top-2 -right-2 w-7 h-7 bg-green-500 rounded-full flex items-center justify-center shadow-lg"},td={class:"flex-1"},sd={class:"flex items-center gap-3 mb-2"},ad={class:"text-3xl font-bold bg-gradient-to-r from-slate-900 via-blue-900 to-indigo-900 dark:from-white dark:via-blue-100 dark:to-indigo-100 bg-clip-text text-transparent"},id=["title"],od={class:"text-slate-600 dark:text-slate-400 text-lg leading-relaxed"},rd={class:"flex flex-wrap items-center gap-4 mt-3 text-sm text-slate-500 dark:text-slate-400"},nd={class:"flex items-center gap-1"},ld={key:1,class:"flex items-center gap-1"},dd={class:"capitalize"},cd={class:"flex flex-wrap gap-3"},ud={key:2,class:"inline-flex items-center px-4 py-2 rounded-full text-sm font-medium bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-300"},md={class:"flex flex-col sm:flex-row gap-3"},hd={class:"flex gap-2"},gd={key:0,class:"flex gap-2"},_d={key:1,class:"flex gap-2"},xd={class:"px-6 py-6"},fd={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},bd={class:"lg:col-span-2 space-y-6"},vd={class:"bg-white/80 dark:bg-slate-800/80 backdrop-blur-xl rounded-2xl shadow-lg border border-slate-200/50 dark:border-slate-700/50 overflow-hidden"},kd={class:"px-6 py-4 bg-gradient-to-r from-slate-50 to-slate-100/50 dark:from-slate-700/50 dark:to-slate-800/50 border-b border-slate-200 dark:border-slate-700"},pd={class:"flex items-center justify-between"},yd={class:"text-xl font-semibold text-slate-900 dark:text-white"},wd={class:"flex items-center gap-2"},Cd={class:"p-6"},$d={class:"mb-6"},Td={class:"text-lg font-medium text-slate-900 dark:text-white mb-3 flex items-center gap-2"},Sd=["innerHTML"],Ad={key:1,class:"text-slate-500 dark:text-slate-400 italic"},Md={key:0,class:"mb-6"},jd={class:"text-lg font-medium text-slate-900 dark:text-white mb-3 flex items-center gap-2"},Id=["innerHTML"],Dd={key:1,class:"mb-6"},Pd={class:"text-lg font-medium text-slate-900 dark:text-white mb-3 flex items-center gap-2"},Nd={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},Ud={class:"flex items-center gap-3 flex-1 min-w-0"},Ld={class:"flex-shrink-0"},Ed={class:"w-10 h-10 bg-blue-100 dark:bg-blue-900/20 rounded-lg flex items-center justify-center"},Fd={class:"flex-1 min-w-0"},Rd={class:"text-sm font-medium text-slate-900 dark:text-white truncate"},qd={class:"text-xs text-slate-500 dark:text-slate-400"},Yd={key:0,class:"text-xs text-slate-400 dark:text-slate-500"},Od={class:"flex items-center gap-2"},Bd=["onClick","title"],Vd={class:"bg-white/80 dark:bg-slate-800/80 backdrop-blur-xl rounded-2xl shadow-lg border border-slate-200/50 dark:border-slate-700/50 overflow-hidden"},Hd={key:0,class:"bg-white/80 dark:bg-slate-800/80 backdrop-blur-xl rounded-2xl shadow-lg border border-slate-200/50 dark:border-slate-700/50 overflow-hidden"},Jd={key:1,class:"bg-white/80 dark:bg-slate-800/80 backdrop-blur-xl rounded-2xl shadow-lg border border-slate-200/50 dark:border-slate-700/50 overflow-hidden"},Xd={class:"space-y-6"},zd={class:"bg-white/80 dark:bg-slate-800/80 backdrop-blur-xl rounded-2xl shadow-lg border border-slate-200/50 dark:border-slate-700/50 overflow-hidden"},Gd={class:"px-6 py-4 bg-gradient-to-r from-slate-50 to-slate-100/50 dark:from-slate-700/50 dark:to-slate-800/50 border-b border-slate-200 dark:border-slate-700"},Wd={class:"text-lg font-semibold text-slate-900 dark:text-white"},Qd={class:"p-6 space-y-4"},Kd={class:"flex justify-between"},Zd={class:"text-sm text-slate-500 dark:text-slate-400"},ec={class:"text-sm font-medium text-slate-900 dark:text-white"},tc={class:"flex justify-between"},sc={class:"text-sm text-slate-500 dark:text-slate-400"},ac={class:"text-sm font-medium text-slate-900 dark:text-white"},ic={class:"flex justify-between"},oc={class:"text-sm text-slate-500 dark:text-slate-400"},rc={class:"text-sm font-medium text-slate-900 dark:text-white"},nc={class:"flex justify-between"},lc={class:"text-sm text-slate-500 dark:text-slate-400"},dc={class:"text-sm font-medium text-slate-900 dark:text-white"},cc={class:"flex justify-between"},uc={class:"text-sm text-slate-500 dark:text-slate-400"},mc={class:"text-sm font-medium text-slate-900 dark:text-white"},hc={class:"flex justify-between"},gc={class:"text-sm text-slate-500 dark:text-slate-400"},_c={class:"text-sm font-medium text-slate-900 dark:text-white capitalize"},xc={class:"bg-white/80 dark:bg-slate-800/80 backdrop-blur-xl rounded-2xl shadow-lg border border-slate-200/50 dark:border-slate-700/50 overflow-hidden"},fc={class:"px-6 py-4 bg-gradient-to-r from-slate-50 to-slate-100/50 dark:from-slate-700/50 dark:to-slate-800/50 border-b border-slate-200 dark:border-slate-700"},bc={class:"text-lg font-semibold text-slate-900 dark:text-white"},vc={class:"p-6 space-y-4"},kc={class:"flex items-center gap-3"},pc={class:"text-sm font-medium text-slate-900 dark:text-white"},yc={class:"text-xs text-slate-500 dark:text-slate-400"},wc={key:0,class:"flex items-center gap-3"},Cc={class:"text-sm font-medium text-slate-900 dark:text-white"},$c={class:"text-xs text-slate-500 dark:text-slate-400"},Tc={key:1,class:"flex items-center gap-3"},Sc={class:"text-sm font-medium text-slate-900 dark:text-white"},Ac={class:"text-xs text-slate-500 dark:text-slate-400"},Mc={key:2,class:"flex items-center gap-3"},jc={class:"text-sm font-medium text-slate-900 dark:text-white"},Ic={class:"text-xs text-slate-500 dark:text-slate-400"},Dc={key:0,class:"bg-white/80 dark:bg-slate-800/80 backdrop-blur-xl rounded-2xl shadow-lg border border-slate-200/50 dark:border-slate-700/50 overflow-hidden"},Pc={class:"px-6 py-4 bg-gradient-to-r from-slate-50 to-slate-100/50 dark:from-slate-700/50 dark:to-slate-800/50 border-b border-slate-200 dark:border-slate-700"},Nc={class:"text-lg font-semibold text-slate-900 dark:text-white"},Uc={class:"p-6 space-y-4"},Lc={key:0,class:"flex justify-between"},Ec={class:"text-sm text-slate-500 dark:text-slate-400"},Fc={class:"text-sm font-medium text-slate-900 dark:text-white"},Rc={key:1,class:"flex justify-between"},qc={class:"text-sm text-slate-500 dark:text-slate-400"},Yc={class:"text-sm font-medium text-slate-900 dark:text-white"},Oc={key:2,class:"pt-2 border-t border-slate-200 dark:border-slate-700"},Bc={class:"flex justify-between"},Vc={class:"text-sm text-slate-500 dark:text-slate-400"},Hc={key:1,class:"bg-white/80 dark:bg-slate-800/80 backdrop-blur-xl rounded-2xl shadow-lg border border-slate-200/50 dark:border-slate-700/50 overflow-hidden"},Jc={class:"px-6 py-4 bg-gradient-to-r from-slate-50 to-slate-100/50 dark:from-slate-700/50 dark:to-slate-800/50 border-b border-slate-200 dark:border-slate-700"},Xc={class:"text-lg font-semibold text-slate-900 dark:text-white"},zc={class:"p-6"},Gc={class:"flex flex-wrap gap-2"};function Wc(t,s,i,b,n,o){var ce;const v=c("Head"),x=c("Link"),_=c("ChevronRight"),h=c("Ticket"),f=c("AlertTriangle"),k=c("Clock"),C=c("AlertCircle"),u=c("CheckCircle"),m=c("Copy"),D=c("Calendar"),N=c("Globe"),V=c("TrendingUp"),$=c("Zap"),U=c("Tag"),L=c("Star"),E=c("Share2"),F=c("Printer"),de=c("MessageCircle"),pe=c("Edit"),ye=c("Eye"),we=c("EyeOff"),Ce=c("FileText"),$e=c("Paperclip"),Te=c("File"),Se=c("Download"),Ae=c("TicketTimeline"),Me=c("ConversationManager"),je=c("ConversationAnalytics"),Ie=c("ConversationStarter"),De=c("CustomerConversationStarter"),Pe=c("NotificationManager");return r(),l("div",Fl,[d(v,{title:t.$t(i.title)},null,8,["title"]),e("div",Rl,[s[10]||(s[10]=e("div",{class:"absolute inset-0 bg-gradient-to-r from-blue-600/5 via-purple-600/5 to-indigo-600/5 dark:from-blue-400/10 dark:via-purple-400/10 dark:to-indigo-400/10"},null,-1)),e("div",ql,[e("div",Yl,[e("nav",Ol,[d(x,{href:t.route("tickets"),class:"text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200 transition-colors"},{default:z(()=>[w(a(t.$t("Tickets")),1)]),_:1},8,["href"]),d(_,{class:"w-4 h-4 text-slate-400"}),e("span",Bl,"#"+a(i.ticket.uid),1)])])]),e("div",Vl,[e("div",Hl,[e("div",Jl,[e("div",Xl,[e("div",zl,[e("div",Gl,[e("div",Wl,[d(h,{class:"w-7 h-7 text-white"})]),i.ticket.sla_status==="breached"?(r(),l("div",Ql,[d(f,{class:"w-4 h-4 text-white"})])):i.ticket.sla_status==="overdue"?(r(),l("div",Kl,[d(k,{class:"w-4 h-4 text-white"})])):i.ticket.sla_status==="warning"?(r(),l("div",Zl,[d(C,{class:"w-4 h-4 text-white"})])):i.ticket.sla_status==="normal"?(r(),l("div",ed,[d(u,{class:"w-4 h-4 text-white"})])):g("",!0)]),e("div",td,[e("div",sd,[e("h1",ad," #"+a(i.ticket.uid),1),e("button",{onClick:s[0]||(s[0]=(...y)=>o.copyTicketId&&o.copyTicketId(...y)),class:"p-1 text-slate-400 hover:text-slate-600 dark:hover:text-slate-300 transition-colors",title:t.$t("Copy Ticket ID")},[d(m,{class:"w-4 h-4"})],8,id)]),e("p",od,a(i.ticket.subject),1),e("div",rd,[e("div",nd,[d(D,{class:"w-4 h-4"}),e("span",null,a(t.$t("Created"))+" "+a(n.moment(i.ticket.created_at).format("MMM D, YYYY")),1)]),i.ticket.due_date?(r(),l("div",{key:0,class:p(["flex items-center gap-1",i.ticket.is_overdue?"text-red-500":"text-slate-500"])},[d(k,{class:"w-4 h-4"}),e("span",null,a(t.$t("Due"))+" "+a(n.moment(i.ticket.due_date).format("MMM D, YYYY")),1)],2)):g("",!0),i.ticket.source?(r(),l("div",ld,[d(N,{class:"w-4 h-4"}),e("span",dd,a(i.ticket.source),1)])):g("",!0)])])]),e("div",cd,[e("span",{class:p(["inline-flex items-center px-4 py-2 rounded-full text-sm font-medium shadow-sm",o.getStatusClass(i.ticket.status)])},[e("div",{class:p(["w-2 h-2 rounded-full mr-2",o.getStatusDotClass(i.ticket.status)])},null,2),w(" "+a(((ce=i.ticket.status)==null?void 0:ce.name)||"N/A"),1)],2),e("span",{class:p(["inline-flex items-center px-4 py-2 rounded-full text-sm font-medium shadow-sm",o.getPriorityClass(i.ticket.priority)])},[e("div",{class:p(["w-2 h-2 rounded-full mr-2",o.getPriorityDotClass(i.ticket.priority)])},null,2),w(" "+a(i.ticket.priority||"N/A"),1)],2),i.ticket.impact_level?(r(),l("span",{key:0,class:p(["inline-flex items-center px-4 py-2 rounded-full text-sm font-medium shadow-sm",o.getImpactClass(i.ticket.impact_level)])},[d(V,{class:"w-4 h-4 mr-2"}),w(" "+a(t.$t("Impact"))+": "+a(i.ticket.impact_level),1)],2)):g("",!0),i.ticket.urgency_level?(r(),l("span",{key:1,class:p(["inline-flex items-center px-4 py-2 rounded-full text-sm font-medium shadow-sm",o.getUrgencyClass(i.ticket.urgency_level)])},[d($,{class:"w-4 h-4 mr-2"}),w(" "+a(t.$t("Urgency"))+": "+a(i.ticket.urgency_level),1)],2)):g("",!0),i.ticket.tags&&i.ticket.tags.length?(r(),l("span",ud,[d(U,{class:"w-4 h-4 mr-2"}),w(" "+a(i.ticket.tags.length)+" "+a(t.$t("tags")),1)])):g("",!0)])]),e("div",md,[e("div",hd,[e("button",{onClick:s[1]||(s[1]=(...y)=>o.toggleFavorite&&o.toggleFavorite(...y)),class:p(["p-2 rounded-lg transition-colors",n.isFavorited?"bg-yellow-100 text-yellow-600 dark:bg-yellow-900/20 dark:text-yellow-400":"bg-slate-100 text-slate-600 hover:bg-slate-200 dark:bg-slate-700 dark:text-slate-400 dark:hover:bg-slate-600"])},[d(L,{class:p([n.isFavorited?"fill-current":"","w-4 h-4"])},null,8,["class"])],2),e("button",{onClick:s[2]||(s[2]=(...y)=>o.shareTicket&&o.shareTicket(...y)),class:"p-2 rounded-lg bg-slate-100 text-slate-600 hover:bg-slate-200 dark:bg-slate-700 dark:text-slate-400 dark:hover:bg-slate-600 transition-colors"},[d(E,{class:"w-4 h-4"})]),e("button",{onClick:s[3]||(s[3]=(...y)=>o.printTicket&&o.printTicket(...y)),class:"p-2 rounded-lg bg-slate-100 text-slate-600 hover:bg-slate-200 dark:bg-slate-700 dark:text-slate-400 dark:hover:bg-slate-600 transition-colors"},[d(F,{class:"w-4 h-4"})])]),o.isAdmin?(r(),l("div",gd,[e("button",{onClick:s[4]||(s[4]=(...y)=>o.startConversation&&o.startConversation(...y)),class:"inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white rounded-lg font-medium transition-all duration-200 shadow-lg hover:shadow-xl hover:-translate-y-0.5"},[d(de,{class:"w-4 h-4"}),e("span",null,a(t.$t("Start Conversation")),1)])])):g("",!0),o.isCustomer?(r(),l("div",_d,[e("button",{onClick:s[5]||(s[5]=(...y)=>o.startCustomerConversation&&o.startCustomerConversation(...y)),class:"inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white rounded-lg font-medium transition-all duration-200 shadow-lg hover:shadow-xl hover:-translate-y-0.5"},[d(de,{class:"w-4 h-4"}),e("span",null,a(t.$t("Contact Support")),1)])])):g("",!0),o.canEditTicket?(r(),A(x,{key:2,href:t.route("tickets.edit",i.ticket.uid),class:"inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white rounded-lg font-medium transition-all duration-200 shadow-lg hover:shadow-xl hover:-translate-y-0.5"},{default:z(()=>[d(pe,{class:"w-4 h-4"}),e("span",null,a(t.$t("Edit Ticket")),1)]),_:1},8,["href"])):g("",!0)])])])])]),e("div",xd,[e("div",fd,[e("div",bd,[e("div",vd,[e("div",kd,[e("div",pd,[e("h2",yd,a(t.$t("Ticket Information")),1),e("div",wd,[e("button",{onClick:s[6]||(s[6]=(...y)=>o.toggleDescription&&o.toggleDescription(...y)),class:"p-1 text-slate-400 hover:text-slate-600 dark:hover:text-slate-300 transition-colors"},[n.showDescription?(r(),A(we,{key:1,class:"w-4 h-4"})):(r(),A(ye,{key:0,class:"w-4 h-4"}))]),e("button",{onClick:s[7]||(s[7]=(...y)=>o.copyDescription&&o.copyDescription(...y)),class:"p-1 text-slate-400 hover:text-slate-600 dark:hover:text-slate-300 transition-colors"},[d(m,{class:"w-4 h-4"})])])])]),e("div",Cd,[e("div",$d,[e("h3",Td,[d(Ce,{class:"w-5 h-5"}),w(" "+a(t.$t("Description")),1)]),n.showDescription?(r(),l("div",{key:0,class:"prose dark:prose-invert max-w-none bg-slate-50 dark:bg-slate-700/50 rounded-lg p-4",innerHTML:i.ticket.details},null,8,Sd)):(r(),l("div",Ad,a(t.$t("Description hidden")),1))]),i.ticket.resolution?(r(),l("div",Md,[e("h3",jd,[d(u,{class:"w-5 h-5 text-green-500"}),w(" "+a(t.$t("Resolution")),1)]),e("div",{class:"prose dark:prose-invert max-w-none bg-green-50 dark:bg-green-900/20 rounded-lg p-4 border border-green-200 dark:border-green-800",innerHTML:i.ticket.resolution},null,8,Id)])):g("",!0),i.attachments.length?(r(),l("div",Dd,[e("h3",Pd,[d($e,{class:"w-5 h-5"}),w(" "+a(t.$t("Attachments"))+" ("+a(i.attachments.length)+") ",1)]),e("div",Nd,[(r(!0),l(T,null,S(i.attachments,y=>(r(),l("div",{key:y.id,class:"group flex items-center justify-between p-4 bg-slate-50 dark:bg-slate-700 rounded-xl border border-slate-200 dark:border-slate-600 hover:bg-slate-100 dark:hover:bg-slate-600 transition-colors"},[e("div",Ud,[e("div",Ld,[e("div",Ed,[d(Te,{class:"w-5 h-5 text-blue-600 dark:text-blue-400"})])]),e("div",Fd,[e("p",Rd,a(y.name),1),e("p",qd,a(o.getFileSize(y.size))+"  "+a(n.moment(y.created_at).format("MMM D, YYYY")),1),y.user?(r(),l("p",Yd,a(t.$t("by"))+" "+a(y.user.first_name)+" "+a(y.user.last_name),1)):g("",!0)])]),e("div",Od,[e("button",{onClick:Qc=>o.downloadAttachment(y),class:"p-1 text-slate-400 hover:text-green-600 dark:hover:text-green-400 transition-colors",title:t.$t("Download")},[d(Se,{class:"w-4 h-4"})],8,Bd)])]))),128))])])):g("",!0)])]),e("div",Vd,[d(Ae,{comments:i.comments,activities:i.activities,attachments:i.attachments},null,8,["comments","activities","attachments"])]),o.isAdmin?(r(),l("div",Hd,[d(Me,{"ticket-id":i.ticket.id,conversations:o.displayConversations,loading:n.conversationsLoading,user:i.user,onRefreshConversations:o.refreshConversations,onStartNewConversation:o.startConversation,onJoinConversation:o.joinConversation,onViewConversationDetails:o.viewConversationDetails},null,8,["ticket-id","conversations","loading","user","onRefreshConversations","onStartNewConversation","onJoinConversation","onViewConversationDetails"])])):g("",!0),o.isAdmin&&o.displayConversations.length>0?(r(),l("div",Jd,[d(je,{"ticket-id":i.ticket.id,conversations:o.displayConversations},null,8,["ticket-id","conversations"])])):g("",!0)]),e("div",Xd,[e("div",zd,[e("div",Gd,[e("h2",Wd,a(t.$t("Details")),1)]),e("div",Qd,[e("div",Kd,[e("span",Zd,a(t.$t("Customer")),1),e("span",ec,a(i.ticket.user),1)]),e("div",tc,[e("span",sc,a(t.$t("Assigned to")),1),e("span",ac,a(i.ticket.assigned_user||"Unassigned"),1)]),e("div",ic,[e("span",oc,a(t.$t("Department")),1),e("span",rc,a(i.ticket.department||"N/A"),1)]),e("div",nc,[e("span",lc,a(t.$t("Category")),1),e("span",dc,a(i.ticket.category||"N/A"),1)]),e("div",cc,[e("span",uc,a(t.$t("Type")),1),e("span",mc,a(i.ticket.type||"N/A"),1)]),e("div",hc,[e("span",gc,a(t.$t("Source")),1),e("span",_c,a(i.ticket.source||"Web"),1)])])]),e("div",xc,[e("div",fc,[e("h2",bc,a(t.$t("Timeline")),1)]),e("div",vc,[e("div",kc,[s[11]||(s[11]=e("div",{class:"w-2 h-2 bg-green-500 rounded-full"},null,-1)),e("div",null,[e("p",pc,a(t.$t("Created")),1),e("p",yc,a(n.moment(i.ticket.created_at).format("MMM D, YYYY h:mm A")),1)])]),i.ticket.due_date?(r(),l("div",wc,[e("div",{class:p(["w-2 h-2 rounded-full",i.ticket.is_overdue?"bg-red-500":"bg-blue-500"])},null,2),e("div",null,[e("p",Cc,a(t.$t("Due Date")),1),e("p",$c,a(n.moment(i.ticket.due_date).format("MMM D, YYYY h:mm A")),1)])])):g("",!0),i.ticket.last_customer_response?(r(),l("div",Tc,[s[12]||(s[12]=e("div",{class:"w-2 h-2 bg-purple-500 rounded-full"},null,-1)),e("div",null,[e("p",Sc,a(t.$t("Last Customer Response")),1),e("p",Ac,a(n.moment(i.ticket.last_customer_response).format("MMM D, YYYY h:mm A")),1)])])):g("",!0),i.ticket.last_agent_response?(r(),l("div",Mc,[s[13]||(s[13]=e("div",{class:"w-2 h-2 bg-orange-500 rounded-full"},null,-1)),e("div",null,[e("p",jc,a(t.$t("Last Agent Response")),1),e("p",Ic,a(n.moment(i.ticket.last_agent_response).format("MMM D, YYYY h:mm A")),1)])])):g("",!0)])]),i.ticket.estimated_hours||i.ticket.actual_hours?(r(),l("div",Dc,[e("div",Pc,[e("h2",Nc,a(t.$t("Time Tracking")),1)]),e("div",Uc,[i.ticket.estimated_hours?(r(),l("div",Lc,[e("span",Ec,a(t.$t("Estimated Hours")),1),e("span",Fc,a(i.ticket.estimated_hours)+"h",1)])):g("",!0),i.ticket.actual_hours?(r(),l("div",Rc,[e("span",qc,a(t.$t("Actual Hours")),1),e("span",Yc,a(i.ticket.actual_hours)+"h",1)])):g("",!0),i.ticket.estimated_hours&&i.ticket.actual_hours?(r(),l("div",Oc,[e("div",Bc,[e("span",Vc,a(t.$t("Remaining")),1),e("span",{class:p(["text-sm font-medium",i.ticket.estimated_hours-i.ticket.actual_hours<0?"text-red-600 dark:text-red-400":"text-slate-900 dark:text-white"])},a((i.ticket.estimated_hours-i.ticket.actual_hours).toFixed(1))+"h ",3)])])):g("",!0)])])):g("",!0),i.ticket.tags&&i.ticket.tags.length?(r(),l("div",Hc,[e("div",Jc,[e("h2",Xc,a(t.$t("Tags")),1)]),e("div",zc,[e("div",Gc,[(r(!0),l(T,null,S(i.ticket.tags,y=>(r(),l("span",{key:y,class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-300"},a(y),1))),128))])])])):g("",!0)])])]),o.isAdmin?(r(),A(Ie,{key:0,show:n.showConversationStarter,ticket:i.ticket,"available-users":i.availableUsers,onClose:s[8]||(s[8]=y=>n.showConversationStarter=!1),onConversationCreated:o.handleConversationCreated,onConversationError:o.handleConversationError},null,8,["show","ticket","available-users","onConversationCreated","onConversationError"])):g("",!0),o.isCustomer?(r(),A(De,{key:1,show:n.showCustomerConversationStarter,ticket:i.ticket,user:i.user,onClose:s[9]||(s[9]=y=>n.showCustomerConversationStarter=!1),onConversationCreated:o.handleConversationCreated,onConversationError:o.handleConversationError},null,8,["show","ticket","user","onConversationCreated","onConversationError"])):g("",!0),d(Pe,{ref:"notificationManager"},null,512)])}const n0=j(El,[["render",Wc],["__scopeId","data-v-1a7c154f"]]);export{n0 as default};
